"use strict";(globalThis.webpackChunkgithub_docs=globalThis.webpackChunkgithub_docs||[]).push([[594],{8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}},8809:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>_,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"alembic/basic/constraints","title":"\uc81c\uc57d\uc870\uac74\uacfc \uc778\ub371\uc2a4","description":"\ub370\uc774\ud130 \ubb34\uacb0\uc131\uc744 \uc704\ud55c \uc81c\uc57d\uc870\uac74\uacfc \uc131\ub2a5 \ud5a5\uc0c1\uc744 \uc704\ud55c \uc778\ub371\uc2a4\ub97c \uad00\ub9ac\ud558\ub294 \ubc29\ubc95\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!","source":"@site/docs/alembic/basic/constraints.md","sourceDirName":"alembic/basic","slug":"/alembic/basic/constraints","permalink":"/tobias-docs/comp-2/docs/alembic/basic/constraints","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/alembic/basic/constraints.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"alembicSidebar","previous":{"title":"\uceec\ub7fc \uc791\uc5c5","permalink":"/tobias-docs/comp-2/docs/alembic/basic/columns"},"next":{"title":"\uc2e4\uc804 \uc2dc\ub098\ub9ac\uc624 \uc18c\uac1c","permalink":"/tobias-docs/comp-2/docs/alembic/examples/intro"}}');var i=s(4848),t=s(8453);const d={sidebar_position:8},o="\uc81c\uc57d\uc870\uac74\uacfc \uc778\ub371\uc2a4",a={},c=[{value:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c",id:"-\ud559\uc2b5-\ubaa9\ud45c",level:2},{value:"\ud83d\udd11 Primary Key (\uae30\ubcf8 \ud0a4)",id:"-primary-key-\uae30\ubcf8-\ud0a4",level:2},{value:"\uae30\ubcf8 \ud0a4 \uc0dd\uc131",id:"\uae30\ubcf8-\ud0a4-\uc0dd\uc131",level:3},{value:"\ubcf5\ud569 \uae30\ubcf8 \ud0a4",id:"\ubcf5\ud569-\uae30\ubcf8-\ud0a4",level:3},{value:"\ud83d\udd17 Foreign Key (\uc678\ub798 \ud0a4)",id:"-foreign-key-\uc678\ub798-\ud0a4",level:2},{value:"\uc678\ub798 \ud0a4 \uc0dd\uc131",id:"\uc678\ub798-\ud0a4-\uc0dd\uc131",level:3},{value:"CASCADE \uc635\uc158\uacfc \ud568\uaed8",id:"cascade-\uc635\uc158\uacfc-\ud568\uaed8",level:3},{value:"\ub2e4\uc591\ud55c CASCADE \uc635\uc158",id:"\ub2e4\uc591\ud55c-cascade-\uc635\uc158",level:3},{value:"\u2728 Unique Constraint (\uc720\ub2c8\ud06c \uc81c\uc57d\uc870\uac74)",id:"-unique-constraint-\uc720\ub2c8\ud06c-\uc81c\uc57d\uc870\uac74",level:2},{value:"\ub2e8\uc77c \uceec\ub7fc \uc720\ub2c8\ud06c",id:"\ub2e8\uc77c-\uceec\ub7fc-\uc720\ub2c8\ud06c",level:3},{value:"\ubcf5\ud569 \uc720\ub2c8\ud06c",id:"\ubcf5\ud569-\uc720\ub2c8\ud06c",level:3},{value:"\u2705 Check Constraint (\uccb4\ud06c \uc81c\uc57d\uc870\uac74)",id:"-check-constraint-\uccb4\ud06c-\uc81c\uc57d\uc870\uac74",level:2},{value:"\uc22b\uc790 \ubc94\uc704 \uccb4\ud06c",id:"\uc22b\uc790-\ubc94\uc704-\uccb4\ud06c",level:3},{value:"\ubb38\uc790\uc5f4 \uac80\uc99d",id:"\ubb38\uc790\uc5f4-\uac80\uc99d",level:3},{value:"\ub0a0\uc9dc \uac80\uc99d",id:"\ub0a0\uc9dc-\uac80\uc99d",level:3},{value:"\ud83d\udcca Index (\uc778\ub371\uc2a4)",id:"-index-\uc778\ub371\uc2a4",level:2},{value:"\ub2e8\uc77c \uceec\ub7fc \uc778\ub371\uc2a4",id:"\ub2e8\uc77c-\uceec\ub7fc-\uc778\ub371\uc2a4",level:3},{value:"\ubcf5\ud569 \uc778\ub371\uc2a4",id:"\ubcf5\ud569-\uc778\ub371\uc2a4",level:3},{value:"\ubd80\ubd84 \uc778\ub371\uc2a4 (Partial Index)",id:"\ubd80\ubd84-\uc778\ub371\uc2a4-partial-index",level:3},{value:"\ud568\uc218 \uae30\ubc18 \uc778\ub371\uc2a4",id:"\ud568\uc218-\uae30\ubc18-\uc778\ub371\uc2a4",level:3},{value:"\ud83c\udfa8 \uc2e4\uc804 \uc608\uc81c",id:"-\uc2e4\uc804-\uc608\uc81c",level:2},{value:"\uc608\uc81c 1: \uc804\uc790\uc0c1\uac70\ub798 \uc81c\uc57d\uc870\uac74",id:"\uc608\uc81c-1-\uc804\uc790\uc0c1\uac70\ub798-\uc81c\uc57d\uc870\uac74",level:3},{value:"\uc608\uc81c 2: \uc18c\uc15c \ubbf8\ub514\uc5b4 \uc81c\uc57d\uc870\uac74",id:"\uc608\uc81c-2-\uc18c\uc15c-\ubbf8\ub514\uc5b4-\uc81c\uc57d\uc870\uac74",level:3},{value:"\ud83d\udcca \uc778\ub371\uc2a4 \uc804\ub7b5",id:"-\uc778\ub371\uc2a4-\uc804\ub7b5",level:2},{value:"1. \uc790\uc8fc \uac80\uc0c9\ud558\ub294 \uceec\ub7fc",id:"1-\uc790\uc8fc-\uac80\uc0c9\ud558\ub294-\uceec\ub7fc",level:3},{value:"2. JOIN\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uc678\ub798 \ud0a4",id:"2-join\uc5d0-\uc0ac\uc6a9\ub418\ub294-\uc678\ub798-\ud0a4",level:3},{value:"3. ORDER BY\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uceec\ub7fc",id:"3-order-by\uc5d0-\uc0ac\uc6a9\ub418\ub294-\uceec\ub7fc",level:3},{value:"4. \ubcf5\ud569 \uc778\ub371\uc2a4 \uc21c\uc11c",id:"4-\ubcf5\ud569-\uc778\ub371\uc2a4-\uc21c\uc11c",level:3},{value:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d",id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",level:2},{value:"1. \uc81c\uc57d\uc870\uac74 \uc774\ub984 \ucda9\ub3cc",id:"1-\uc81c\uc57d\uc870\uac74-\uc774\ub984-\ucda9\ub3cc",level:3},{value:"2. \uae30\uc874 \ub370\uc774\ud130\uc640 \uc81c\uc57d\uc870\uac74 \ucda9\ub3cc",id:"2-\uae30\uc874-\ub370\uc774\ud130\uc640-\uc81c\uc57d\uc870\uac74-\ucda9\ub3cc",level:3},{value:"3. \uacfc\ub3c4\ud55c \uc778\ub371\uc2a4",id:"3-\uacfc\ub3c4\ud55c-\uc778\ub371\uc2a4",level:3},{value:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c",id:"-\uc2e4\uc2b5-\uacfc\uc81c",level:2},{value:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac",id:"-\ud575\uc2ec-\uc815\ub9ac",level:2},{value:"\uc81c\uc57d\uc870\uac74",id:"\uc81c\uc57d\uc870\uac74",level:3},{value:"\uc778\ub371\uc2a4",id:"\uc778\ub371\uc2a4",level:3},{value:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4",id:"-\ub2e4\uc74c-\ub2e8\uacc4",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\uc81c\uc57d\uc870\uac74\uacfc-\uc778\ub371\uc2a4",children:"\uc81c\uc57d\uc870\uac74\uacfc \uc778\ub371\uc2a4"})}),"\n",(0,i.jsx)(n.p,{children:"\ub370\uc774\ud130 \ubb34\uacb0\uc131\uc744 \uc704\ud55c \uc81c\uc57d\uc870\uac74\uacfc \uc131\ub2a5 \ud5a5\uc0c1\uc744 \uc704\ud55c \uc778\ub371\uc2a4\ub97c \uad00\ub9ac\ud558\ub294 \ubc29\ubc95\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!"}),"\n",(0,i.jsx)(n.h2,{id:"-\ud559\uc2b5-\ubaa9\ud45c",children:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ub2e4\uc591\ud55c \uc81c\uc57d\uc870\uac74 \ucd94\uac00/\uc0ad\uc81c"}),"\n",(0,i.jsx)(n.li,{children:"\uc778\ub371\uc2a4 \uc0dd\uc131 \ubc0f \uad00\ub9ac"}),"\n",(0,i.jsx)(n.li,{children:"\ub370\uc774\ud130 \ubb34\uacb0\uc131 \ubcf4\uc7a5"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-primary-key-\uae30\ubcf8-\ud0a4",children:"\ud83d\udd11 Primary Key (\uae30\ubcf8 \ud0a4)"}),"\n",(0,i.jsx)(n.h3,{id:"\uae30\ubcf8-\ud0a4-\uc0dd\uc131",children:"\uae30\ubcf8 \ud0a4 \uc0dd\uc131"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_primary_key('pk_users', 'users', ['id'])\n\ndef downgrade():\n    op.drop_constraint('pk_users', 'users', type_='primary')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ubcf5\ud569-\uae30\ubcf8-\ud0a4",children:"\ubcf5\ud569 \uae30\ubcf8 \ud0a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_primary_key(\n        'pk_post_tags',\n        'post_tags',\n        ['post_id', 'tag_id']\n    )\n\ndef downgrade():\n    op.drop_constraint('pk_post_tags', 'post_tags', type_='primary')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-foreign-key-\uc678\ub798-\ud0a4",children:"\ud83d\udd17 Foreign Key (\uc678\ub798 \ud0a4)"}),"\n",(0,i.jsx)(n.h3,{id:"\uc678\ub798-\ud0a4-\uc0dd\uc131",children:"\uc678\ub798 \ud0a4 \uc0dd\uc131"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_foreign_key(\n        'fk_posts_author',    # \uc81c\uc57d\uc870\uac74 \uc774\ub984\n        'posts',              # source \ud14c\uc774\ube14\n        'users',              # target \ud14c\uc774\ube14\n        ['author_id'],        # source \uceec\ub7fc\n        ['id']                # target \uceec\ub7fc\n    )\n\ndef downgrade():\n    op.drop_constraint('fk_posts_author', 'posts', type_='foreignkey')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cascade-\uc635\uc158\uacfc-\ud568\uaed8",children:"CASCADE \uc635\uc158\uacfc \ud568\uaed8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_foreign_key(\n        'fk_comments_post',\n        'comments',\n        'posts',\n        ['post_id'],\n        ['id'],\n        ondelete='CASCADE',   # \ubd80\ubaa8 \uc0ad\uc81c \uc2dc \uc790\uc2dd\ub3c4 \uc0ad\uc81c\n        onupdate='CASCADE'    # \ubd80\ubaa8 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc790\uc2dd\ub3c4 \uc5c5\ub370\uc774\ud2b8\n    )\n\ndef downgrade():\n    op.drop_constraint('fk_comments_post', 'comments', type_='foreignkey')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ub2e4\uc591\ud55c-cascade-\uc635\uc158",children:"\ub2e4\uc591\ud55c CASCADE \uc635\uc158"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # SET NULL: \ubd80\ubaa8 \uc0ad\uc81c \uc2dc NULL\ub85c \uc124\uc815\n    op.create_foreign_key(\n        'fk_posts_category',\n        'posts', 'categories',\n        ['category_id'], ['id'],\n        ondelete='SET NULL'\n    )\n\n    # RESTRICT: \uc790\uc2dd\uc774 \uc788\uc73c\uba74 \ubd80\ubaa8 \uc0ad\uc81c \ubd88\uac00\n    op.create_foreign_key(\n        'fk_orders_user',\n        'orders', 'users',\n        ['user_id'], ['id'],\n        ondelete='RESTRICT'\n    )\n\n    # NO ACTION: \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uae30\ubcf8 \ub3d9\uc791\n    op.create_foreign_key(\n        'fk_products_supplier',\n        'products', 'suppliers',\n        ['supplier_id'], ['id'],\n        ondelete='NO ACTION'\n    )\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-unique-constraint-\uc720\ub2c8\ud06c-\uc81c\uc57d\uc870\uac74",children:"\u2728 Unique Constraint (\uc720\ub2c8\ud06c \uc81c\uc57d\uc870\uac74)"}),"\n",(0,i.jsx)(n.h3,{id:"\ub2e8\uc77c-\uceec\ub7fc-\uc720\ub2c8\ud06c",children:"\ub2e8\uc77c \uceec\ub7fc \uc720\ub2c8\ud06c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_unique_constraint(\n        'uq_users_email',\n        'users',\n        ['email']\n    )\n\ndef downgrade():\n    op.drop_constraint('uq_users_email', 'users', type_='unique')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ubcf5\ud569-\uc720\ub2c8\ud06c",children:"\ubcf5\ud569 \uc720\ub2c8\ud06c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uac19\uc740 post\uc5d0 \uac19\uc740 user\uac00 \uc911\ubcf5 \uc88b\uc544\uc694 \ubc29\uc9c0\n    op.create_unique_constraint(\n        'uq_likes_user_post',\n        'likes',\n        ['user_id', 'post_id']\n    )\n\ndef downgrade():\n    op.drop_constraint('uq_likes_user_post', 'likes', type_='unique')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-check-constraint-\uccb4\ud06c-\uc81c\uc57d\uc870\uac74",children:"\u2705 Check Constraint (\uccb4\ud06c \uc81c\uc57d\uc870\uac74)"}),"\n",(0,i.jsx)(n.h3,{id:"\uc22b\uc790-\ubc94\uc704-\uccb4\ud06c",children:"\uc22b\uc790 \ubc94\uc704 \uccb4\ud06c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.create_check_constraint(\n        'check_positive_price',\n        'products',\n        'price > 0'\n    )\n\n    op.create_check_constraint(\n        'check_stock_non_negative',\n        'products',\n        'stock >= 0'\n    )\n\n    op.create_check_constraint(\n        'check_rating_range',\n        'products',\n        'rating >= 0 AND rating <= 5'\n    )\n\ndef downgrade():\n    op.drop_constraint('check_rating_range', 'products')\n    op.drop_constraint('check_stock_non_negative', 'products')\n    op.drop_constraint('check_positive_price', 'products')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ubb38\uc790\uc5f4-\uac80\uc99d",children:"\ubb38\uc790\uc5f4 \uac80\uc99d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uc774\uba54\uc77c \ud615\uc2dd \uccb4\ud06c (\uac04\ub2e8\ud55c \ubc84\uc804)\n    op.create_check_constraint(\n        'check_email_format',\n        'users',\n        \"email LIKE '%@%'\"\n    )\n\n    # \uc0c1\ud0dc \uac12 \uc81c\ud55c\n    op.create_check_constraint(\n        'check_order_status',\n        'orders',\n        \"status IN ('pending', 'processing', 'shipped', 'delivered', 'cancelled')\"\n    )\n\ndef downgrade():\n    op.drop_constraint('check_order_status', 'orders')\n    op.drop_constraint('check_email_format', 'users')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ub0a0\uc9dc-\uac80\uc99d",children:"\ub0a0\uc9dc \uac80\uc99d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uc885\ub8cc\uc77c\uc774 \uc2dc\uc791\uc77c\ubcf4\ub2e4 \ub2a6\uc5b4\uc57c \ud568\n    op.create_check_constraint(\n        'check_event_dates',\n        'events',\n        'end_date > start_date'\n    )\n\n    # \ubbf8\ub798 \ub0a0\uc9dc\ub9cc \ud5c8\uc6a9\n    op.create_check_constraint(\n        'check_future_date',\n        'events',\n        'start_date > CURRENT_DATE'\n    )\n\ndef downgrade():\n    op.drop_constraint('check_future_date', 'events')\n    op.drop_constraint('check_event_dates', 'events')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-index-\uc778\ub371\uc2a4",children:"\ud83d\udcca Index (\uc778\ub371\uc2a4)"}),"\n",(0,i.jsx)(n.h3,{id:"\ub2e8\uc77c-\uceec\ub7fc-\uc778\ub371\uc2a4",children:"\ub2e8\uc77c \uceec\ub7fc \uc778\ub371\uc2a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uae30\ubcf8 \uc778\ub371\uc2a4\n    op.create_index('idx_users_email', 'users', ['email'])\n\n    # \uc720\ub2c8\ud06c \uc778\ub371\uc2a4\n    op.create_index('idx_users_username', 'users', ['username'], unique=True)\n\ndef downgrade():\n    op.drop_index('idx_users_username', table_name='users')\n    op.drop_index('idx_users_email', table_name='users')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ubcf5\ud569-\uc778\ub371\uc2a4",children:"\ubcf5\ud569 \uc778\ub371\uc2a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uc5ec\ub7ec \uceec\ub7fc\uc744 \ud568\uaed8 \uc778\ub371\uc2f1\n    op.create_index(\n        'idx_posts_author_created',\n        'posts',\n        ['author_id', 'created_at']\n    )\n\ndef downgrade():\n    op.drop_index('idx_posts_author_created', table_name='posts')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ubd80\ubd84-\uc778\ub371\uc2a4-partial-index",children:"\ubd80\ubd84 \uc778\ub371\uc2a4 (Partial Index)"}),"\n",(0,i.jsx)(n.p,{children:"PostgreSQL\uc5d0\uc11c \uc9c0\uc6d0:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \ud65c\uc131 \uc0ac\uc6a9\uc790\ub9cc \uc778\ub371\uc2f1\n    op.create_index(\n        'idx_active_users',\n        'users',\n        ['email'],\n        postgresql_where=\"is_active = true\"\n    )\n\ndef downgrade():\n    op.drop_index('idx_active_users', table_name='users')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ud568\uc218-\uae30\ubc18-\uc778\ub371\uc2a4",children:"\ud568\uc218 \uae30\ubc18 \uc778\ub371\uc2a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \ub300\uc18c\ubb38\uc790 \uad6c\ubd84 \uc5c6\ub294 \uac80\uc0c9\n    op.execute('''\n        CREATE INDEX idx_users_email_lower\n        ON users (LOWER(email))\n    ''')\n\ndef downgrade():\n    op.execute('DROP INDEX idx_users_email_lower')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-\uc2e4\uc804-\uc608\uc81c",children:"\ud83c\udfa8 \uc2e4\uc804 \uc608\uc81c"}),"\n",(0,i.jsx)(n.h3,{id:"\uc608\uc81c-1-\uc804\uc790\uc0c1\uac70\ub798-\uc81c\uc57d\uc870\uac74",children:"\uc608\uc81c 1: \uc804\uc790\uc0c1\uac70\ub798 \uc81c\uc57d\uc870\uac74"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\"\"\"add ecommerce constraints\n\nRevision ID: ecom001\n\"\"\"\n\ndef upgrade():\n    # Products \ud14c\uc774\ube14\n    op.create_check_constraint(\n        'check_product_price',\n        'products',\n        'price >= 0 AND price <= 999999.99'\n    )\n    op.create_check_constraint(\n        'check_product_stock',\n        'products',\n        'stock >= 0'\n    )\n\n    # Orders \ud14c\uc774\ube14\n    op.create_check_constraint(\n        'check_order_total',\n        'orders',\n        'total_amount > 0'\n    )\n    op.create_check_constraint(\n        'check_order_status',\n        'orders',\n        \"status IN ('cart', 'pending', 'paid', 'shipped', 'delivered', 'refunded')\"\n    )\n\n    # Order Items \ud14c\uc774\ube14\n    op.create_check_constraint(\n        'check_quantity',\n        'order_items',\n        'quantity > 0 AND quantity <= 9999'\n    )\n    op.create_check_constraint(\n        'check_price_calculation',\n        'order_items',\n        'subtotal = quantity * unit_price'\n    )\n\n    # \uc778\ub371\uc2a4\n    op.create_index('idx_orders_user_status', 'orders', ['user_id', 'status'])\n    op.create_index('idx_orders_created', 'orders', ['created_at'])\n    op.create_index('idx_products_category', 'products', ['category_id'])\n\ndef downgrade():\n    op.drop_index('idx_products_category', table_name='products')\n    op.drop_index('idx_orders_created', table_name='orders')\n    op.drop_index('idx_orders_user_status', table_name='orders')\n\n    op.drop_constraint('check_price_calculation', 'order_items')\n    op.drop_constraint('check_quantity', 'order_items')\n    op.drop_constraint('check_order_status', 'orders')\n    op.drop_constraint('check_order_total', 'orders')\n    op.drop_constraint('check_product_stock', 'products')\n    op.drop_constraint('check_product_price', 'products')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\uc608\uc81c-2-\uc18c\uc15c-\ubbf8\ub514\uc5b4-\uc81c\uc57d\uc870\uac74",children:"\uc608\uc81c 2: \uc18c\uc15c \ubbf8\ub514\uc5b4 \uc81c\uc57d\uc870\uac74"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\"\"\"add social media constraints\n\nRevision ID: social001\n\"\"\"\n\ndef upgrade():\n    # Users\n    op.create_unique_constraint('uq_users_email', 'users', ['email'])\n    op.create_unique_constraint('uq_users_username', 'users', ['username'])\n\n    # Posts\n    op.create_foreign_key(\n        'fk_posts_author',\n        'posts', 'users',\n        ['author_id'], ['id'],\n        ondelete='CASCADE'\n    )\n    op.create_index('idx_posts_author_created', 'posts',\n        ['author_id', 'created_at DESC']\n    )\n\n    # Likes\n    op.create_unique_constraint(\n        'uq_likes_user_post',\n        'likes',\n        ['user_id', 'post_id']\n    )\n    op.create_foreign_key('fk_likes_user', 'likes', 'users',\n        ['user_id'], ['id'], ondelete='CASCADE')\n    op.create_foreign_key('fk_likes_post', 'likes', 'posts',\n        ['post_id'], ['id'], ondelete='CASCADE')\n\n    # Follows\n    op.create_unique_constraint(\n        'uq_follows',\n        'follows',\n        ['follower_id', 'following_id']\n    )\n    op.create_check_constraint(\n        'check_no_self_follow',\n        'follows',\n        'follower_id != following_id'\n    )\n\n    # \uc131\ub2a5 \uc778\ub371\uc2a4\n    op.create_index('idx_posts_created', 'posts', ['created_at DESC'])\n    op.create_index('idx_likes_post', 'likes', ['post_id'])\n    op.create_index('idx_follows_following', 'follows', ['following_id'])\n\ndef downgrade():\n    op.drop_index('idx_follows_following', table_name='follows')\n    op.drop_index('idx_likes_post', table_name='likes')\n    op.drop_index('idx_posts_created', table_name='posts')\n\n    op.drop_constraint('check_no_self_follow', 'follows')\n    op.drop_constraint('uq_follows', 'follows', type_='unique')\n\n    op.drop_constraint('fk_likes_post', 'likes', type_='foreignkey')\n    op.drop_constraint('fk_likes_user', 'likes', type_='foreignkey')\n    op.drop_constraint('uq_likes_user_post', 'likes', type_='unique')\n\n    op.drop_index('idx_posts_author_created', table_name='posts')\n    op.drop_constraint('fk_posts_author', 'posts', type_='foreignkey')\n\n    op.drop_constraint('uq_users_username', 'users', type_='unique')\n    op.drop_constraint('uq_users_email', 'users', type_='unique')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-\uc778\ub371\uc2a4-\uc804\ub7b5",children:"\ud83d\udcca \uc778\ub371\uc2a4 \uc804\ub7b5"}),"\n",(0,i.jsx)(n.h3,{id:"1-\uc790\uc8fc-\uac80\uc0c9\ud558\ub294-\uceec\ub7fc",children:"1. \uc790\uc8fc \uac80\uc0c9\ud558\ub294 \uceec\ub7fc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # WHERE \uc808\uc5d0 \uc790\uc8fc \uc0ac\uc6a9\ub418\ub294 \uceec\ub7fc\n    op.create_index('idx_users_email', 'users', ['email'])\n    op.create_index('idx_posts_status', 'posts', ['status'])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-join\uc5d0-\uc0ac\uc6a9\ub418\ub294-\uc678\ub798-\ud0a4",children:"2. JOIN\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uc678\ub798 \ud0a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # JOIN \uc131\ub2a5 \ud5a5\uc0c1\n    op.create_index('idx_posts_author_id', 'posts', ['author_id'])\n    op.create_index('idx_comments_post_id', 'comments', ['post_id'])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-order-by\uc5d0-\uc0ac\uc6a9\ub418\ub294-\uceec\ub7fc",children:"3. ORDER BY\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uceec\ub7fc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \uc815\ub82c \uc131\ub2a5 \ud5a5\uc0c1\n    op.create_index('idx_posts_created_desc', 'posts',\n        [sa.text('created_at DESC')]\n    )\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-\ubcf5\ud569-\uc778\ub371\uc2a4-\uc21c\uc11c",children:"4. \ubcf5\ud569 \uc778\ub371\uc2a4 \uc21c\uc11c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \u2705 \uc88b\uc740 \uc608: \uc120\ud0dd\ub3c4\uac00 \ub192\uc740 \uceec\ub7fc \uba3c\uc800\n    op.create_index('idx_orders_user_status_date', 'orders',\n        ['user_id', 'status', 'created_at']\n    )\n\n    # \u274c \ub098\uc05c \uc608: \uc120\ud0dd\ub3c4\uac00 \ub0ae\uc740 \uceec\ub7fc \uba3c\uc800\n    # op.create_index('idx_orders_status_user', 'orders',\n    #     ['status', 'user_id']  # status\ub294 \uac12\uc774 \uba87 \uac1c \uc548 \ub428\n    # )\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",children:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d"}),"\n",(0,i.jsx)(n.h3,{id:"1-\uc81c\uc57d\uc870\uac74-\uc774\ub984-\ucda9\ub3cc",children:"1. \uc81c\uc57d\uc870\uac74 \uc774\ub984 \ucda9\ub3cc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u274c \uc5d0\ub7ec: \uac19\uc740 \uc774\ub984\uc758 \uc81c\uc57d\uc870\uac74 \uc874\uc7ac\ndef upgrade():\n    op.create_unique_constraint('unique_email', 'users', ['email'])\n    op.create_unique_constraint('unique_email', 'admins', ['email'])  # \uc5d0\ub7ec!\n\n# \u2705 \uc62c\ubc14\ub978 \ubc29\ubc95: \ud14c\uc774\ube14\uba85 \ud3ec\ud568\ndef upgrade():\n    op.create_unique_constraint('uq_users_email', 'users', ['email'])\n    op.create_unique_constraint('uq_admins_email', 'admins', ['email'])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\uae30\uc874-\ub370\uc774\ud130\uc640-\uc81c\uc57d\uc870\uac74-\ucda9\ub3cc",children:"2. \uae30\uc874 \ub370\uc774\ud130\uc640 \uc81c\uc57d\uc870\uac74 \ucda9\ub3cc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # \u274c \uc2e4\ud328: \uc911\ubcf5 \ub370\uc774\ud130\uac00 \uc774\ubbf8 \uc788\uc73c\uba74 \uc5d0\ub7ec\n    op.create_unique_constraint('uq_users_email', 'users', ['email'])\n\n# \u2705 \uc548\uc804\ud55c \ubc29\ubc95\ndef upgrade():\n    # 1. \uc911\ubcf5 \ub370\uc774\ud130 \uc815\ub9ac\n    op.execute('''\n        DELETE FROM users a\n        USING users b\n        WHERE a.id > b.id AND a.email = b.email\n    ''')\n\n    # 2. \uc81c\uc57d\uc870\uac74 \ucd94\uac00\n    op.create_unique_constraint('uq_users_email', 'users', ['email'])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\uacfc\ub3c4\ud55c-\uc778\ub371\uc2a4",children:"3. \uacfc\ub3c4\ud55c \uc778\ub371\uc2a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u274c \ub098\uc05c \uc608: \ub108\ubb34 \ub9ce\uc740 \uc778\ub371\uc2a4\ndef upgrade():\n    op.create_index('idx_1', 'users', ['email'])\n    op.create_index('idx_2', 'users', ['username'])\n    op.create_index('idx_3', 'users', ['first_name'])\n    op.create_index('idx_4', 'users', ['last_name'])\n    op.create_index('idx_5', 'users', ['created_at'])\n    # ... 10\uac1c \ub354\n\n# \u2705 \uc88b\uc740 \uc608: \ud544\uc694\ud55c \uc778\ub371\uc2a4\ub9cc\ndef upgrade():\n    op.create_index('idx_users_email', 'users', ['email'])  # \ub85c\uadf8\uc778\uc6a9\n    op.create_index('idx_users_created', 'users', ['created_at'])  # \uc815\ub82c\uc6a9\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-\uc2e4\uc2b5-\uacfc\uc81c",children:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c"}),"\n",(0,i.jsx)(n.p,{children:"\ube14\ub85c\uadf8 \uc2dc\uc2a4\ud15c\uc758 \uc131\ub2a5\uacfc \ub370\uc774\ud130 \ubb34\uacb0\uc131\uc744 \uac1c\uc120\ud558\uc138\uc694:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"users \ud14c\uc774\ube14:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"email\uc740 \uc720\ub2c8\ud06c"}),"\n",(0,i.jsx)(n.li,{children:"username\uc740 3\uc790 \uc774\uc0c1 20\uc790 \uc774\ud558"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"posts \ud14c\uc774\ube14:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"author_id\ub294 users.id \uc678\ub798 \ud0a4 (CASCADE)"}),"\n",(0,i.jsx)(n.li,{children:"view_count\ub294 0 \uc774\uc0c1"}),"\n",(0,i.jsx)(n.li,{children:"status\ub294 'draft', 'published', 'archived' \uc911 \ud558\ub098"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\uc778\ub371\uc2a4:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"posts: author_id, created_at DESC"}),"\n",(0,i.jsx)(n.li,{children:"posts: status"}),"\n",(0,i.jsx)(n.li,{children:"comments: post_id"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"\uc815\ub2f5 \ubcf4\uae30"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\"\"\"add blog constraints and indexes\n\nRevision ID: blog001\n\"\"\"\n\ndef upgrade():\n    # Users\n    op.create_unique_constraint('uq_users_email', 'users', ['email'])\n    op.create_check_constraint(\n        'check_username_length',\n        'users',\n        'LENGTH(username) >= 3 AND LENGTH(username) <= 20'\n    )\n\n    # Posts\n    op.create_foreign_key(\n        'fk_posts_author',\n        'posts', 'users',\n        ['author_id'], ['id'],\n        ondelete='CASCADE'\n    )\n    op.create_check_constraint(\n        'check_view_count',\n        'posts',\n        'view_count >= 0'\n    )\n    op.create_check_constraint(\n        'check_post_status',\n        'posts',\n        \"status IN ('draft', 'published', 'archived')\"\n    )\n\n    # Indexes\n    op.create_index('idx_posts_author_created', 'posts',\n        ['author_id', sa.text('created_at DESC')]\n    )\n    op.create_index('idx_posts_status', 'posts', ['status'])\n    op.create_index('idx_comments_post', 'comments', ['post_id'])\n\ndef downgrade():\n    op.drop_index('idx_comments_post', table_name='comments')\n    op.drop_index('idx_posts_status', table_name='posts')\n    op.drop_index('idx_posts_author_created', table_name='posts')\n\n    op.drop_constraint('check_post_status', 'posts')\n    op.drop_constraint('check_view_count', 'posts')\n    op.drop_constraint('fk_posts_author', 'posts', type_='foreignkey')\n\n    op.drop_constraint('check_username_length', 'users')\n    op.drop_constraint('uq_users_email', 'users', type_='unique')\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"-\ud575\uc2ec-\uc815\ub9ac",children:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac"}),"\n",(0,i.jsx)(n.h3,{id:"\uc81c\uc57d\uc870\uac74",children:"\uc81c\uc57d\uc870\uac74"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Primary Key"}),": \uae30\ubcf8 \ud0a4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Foreign Key"}),": \uc678\ub798 \ud0a4 (CASCADE \uc635\uc158)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Unique"}),": \uc911\ubcf5 \ubc29\uc9c0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check"}),": \uc870\uac74 \uac80\uc99d"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\uc778\ub371\uc2a4",children:"\uc778\ub371\uc2a4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uac80\uc0c9 \uc131\ub2a5 \ud5a5\uc0c1"}),"\n",(0,i.jsx)(n.li,{children:"JOIN, WHERE, ORDER BY\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uceec\ub7fc"}),"\n",(0,i.jsx)(n.li,{children:"\uacfc\ub3c4\ud55c \uc778\ub371\uc2a4\ub294 INSERT/UPDATE \uc131\ub2a5 \uc800\ud558"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-\ub2e4\uc74c-\ub2e8\uacc4",children:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4"}),"\n",(0,i.jsx)(n.p,{children:"\uae30\ucd08\ud3b8\uc744 \uc644\ub8cc\ud588\uc2b5\ub2c8\ub2e4! \uc774\uc81c \uc911\uae09\ud3b8\uc73c\ub85c \ub118\uc5b4\uac00\ubd05\uc2dc\ub2e4."}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,i.jsx)(n.a,{href:"../intermediate/intro",children:"\uc911\uae09\ud3b8\uc73c\ub85c \uc774\ub3d9"})]})]})}function _(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);