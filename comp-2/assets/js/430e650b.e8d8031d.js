"use strict";(globalThis.webpackChunkgithub_docs=globalThis.webpackChunkgithub_docs||[]).push([[4748],{3963:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"alembic/intermediate/data-migration","title":"\ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158","description":"\uc2a4\ud0a4\ub9c8 \ubcc0\uacbd\uacfc \ud568\uaed8 \ub370\uc774\ud130\ub97c \ubcc0\ud658\ud558\ub294 \ubc29\ubc95\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!","source":"@site/docs/alembic/intermediate/data-migration.md","sourceDirName":"alembic/intermediate","slug":"/alembic/intermediate/data-migration","permalink":"/docs/alembic/intermediate/data-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/alembic/intermediate/data-migration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"alembicSidebar","previous":{"title":"\uc790\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc0dd\uc131 (Autogenerate)","permalink":"/docs/alembic/intermediate/autogenerate"}}');var r=s(4848),t=s(8453);const a={sidebar_position:3},i="\ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158",l={},d=[{value:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c",id:"-\ud559\uc2b5-\ubaa9\ud45c",level:2},{value:"\ud83d\udcdd \uae30\ubcf8 \ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158",id:"-\uae30\ubcf8-\ub370\uc774\ud130-\ub9c8\uc774\uadf8\ub808\uc774\uc158",level:2},{value:"op.execute() \uc0ac\uc6a9",id:"opexecute-\uc0ac\uc6a9",level:3},{value:"\ud83d\udd27 \uc2e4\uc804 \uc608\uc81c",id:"-\uc2e4\uc804-\uc608\uc81c",level:2},{value:"\uc608\uc81c 1: \uac00\uaca9 \ub2e8\uc704 \ubcc0\uacbd (\uc6d0 \u2192 \ub2ec\ub7ec)",id:"\uc608\uc81c-1-\uac00\uaca9-\ub2e8\uc704-\ubcc0\uacbd-\uc6d0--\ub2ec\ub7ec",level:3},{value:"\uc608\uc81c 2: \uc0c1\ud0dc \uac12 \ubcc0\uacbd",id:"\uc608\uc81c-2-\uc0c1\ud0dc-\uac12-\ubcc0\uacbd",level:3},{value:"\uc608\uc81c 3: \uc815\uaddc\ud654 - \ud14c\uc774\ube14 \ubd84\ub9ac",id:"\uc608\uc81c-3-\uc815\uaddc\ud654---\ud14c\uc774\ube14-\ubd84\ub9ac",level:3},{value:"\ud83d\udc0d Python \ucf54\ub4dc \uc0ac\uc6a9",id:"-python-\ucf54\ub4dc-\uc0ac\uc6a9",level:2},{value:"bind\ub97c \ud1b5\ud55c \uc9c1\uc811 SQL \uc2e4\ud589",id:"bind\ub97c-\ud1b5\ud55c-\uc9c1\uc811-sql-\uc2e4\ud589",level:3},{value:"bulk_insert_mappings \uc0ac\uc6a9",id:"bulk_insert_mappings-\uc0ac\uc6a9",level:3},{value:"\ud83d\udcca \ub300\ub7c9 \ub370\uc774\ud130 \ucc98\ub9ac",id:"-\ub300\ub7c9-\ub370\uc774\ud130-\ucc98\ub9ac",level:2},{value:"\ubc30\uce58 \ucc98\ub9ac",id:"\ubc30\uce58-\ucc98\ub9ac",level:3},{value:"\ud2b8\ub79c\uc7ad\uc158 \uad00\ub9ac",id:"\ud2b8\ub79c\uc7ad\uc158-\uad00\ub9ac",level:3},{value:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d",id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",level:2},{value:"1. \ub370\uc774\ud130 \uc190\uc2e4 \ubc29\uc9c0",id:"1-\ub370\uc774\ud130-\uc190\uc2e4-\ubc29\uc9c0",level:3},{value:"2. NULL \uac12 \ucc98\ub9ac",id:"2-null-\uac12-\ucc98\ub9ac",level:3},{value:"3. \uc131\ub2a5 \uace0\ub824",id:"3-\uc131\ub2a5-\uace0\ub824",level:3},{value:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c",id:"-\uc2e4\uc2b5-\uacfc\uc81c",level:2},{value:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac",id:"-\ud575\uc2ec-\uc815\ub9ac",level:2},{value:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4",id:"-\ub2e4\uc74c-\ub2e8\uacc4",level:2}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components},{Details:s}=e;return s||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\ub370\uc774\ud130-\ub9c8\uc774\uadf8\ub808\uc774\uc158",children:"\ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158"})}),"\n",(0,r.jsx)(e.p,{children:"\uc2a4\ud0a4\ub9c8 \ubcc0\uacbd\uacfc \ud568\uaed8 \ub370\uc774\ud130\ub97c \ubcc0\ud658\ud558\ub294 \ubc29\ubc95\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!"}),"\n",(0,r.jsx)(e.h2,{id:"-\ud559\uc2b5-\ubaa9\ud45c",children:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ub370\uc774\ud130 \ubcc0\ud658 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc791\uc131"}),"\n",(0,r.jsx)(e.li,{children:"\ub300\ub7c9 \ub370\uc774\ud130 \uc548\uc804\ud558\uac8c \ucc98\ub9ac"}),"\n",(0,r.jsx)(e.li,{children:"SQL\uacfc Python \ucf54\ub4dc \ud63c\ud569 \uc0ac\uc6a9"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"-\uae30\ubcf8-\ub370\uc774\ud130-\ub9c8\uc774\uadf8\ub808\uc774\uc158",children:"\ud83d\udcdd \uae30\ubcf8 \ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158"}),"\n",(0,r.jsx)(e.h3,{id:"opexecute-\uc0ac\uc6a9",children:"op.execute() \uc0ac\uc6a9"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    # 1. \uceec\ub7fc \ucd94\uac00\n    op.add_column('users', sa.Column('full_name', sa.String(100)))\n\n    # 2. \ub370\uc774\ud130 \ubcc0\ud658\n    op.execute('''\n        UPDATE users\n        SET full_name = first_name || ' ' || last_name\n    ''')\n\n    # 3. \uae30\uc874 \uceec\ub7fc \uc0ad\uc81c (\uc120\ud0dd)\n    op.drop_column('users', 'first_name')\n    op.drop_column('users', 'last_name')\n\ndef downgrade():\n    op.add_column('users', sa.Column('first_name', sa.String(50)))\n    op.add_column('users', sa.Column('last_name', sa.String(50)))\n\n    op.execute('''\n        UPDATE users\n        SET first_name = SPLIT_PART(full_name, ' ', 1),\n            last_name = SPLIT_PART(full_name, ' ', 2)\n    ''')\n\n    op.drop_column('users', 'full_name')\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\uc2e4\uc804-\uc608\uc81c",children:"\ud83d\udd27 \uc2e4\uc804 \uc608\uc81c"}),"\n",(0,r.jsx)(e.h3,{id:"\uc608\uc81c-1-\uac00\uaca9-\ub2e8\uc704-\ubcc0\uacbd-\uc6d0--\ub2ec\ub7ec",children:"\uc608\uc81c 1: \uac00\uaca9 \ub2e8\uc704 \ubcc0\uacbd (\uc6d0 \u2192 \ub2ec\ub7ec)"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"\"\"\"convert prices from KRW to USD\n\nRevision ID: price001\n\"\"\"\n\ndef upgrade():\n    # 1. \uc0c8 \uceec\ub7fc \ucd94\uac00\n    op.add_column('products',\n        sa.Column('price_usd', sa.Numeric(10, 2))\n    )\n\n    # 2. \ud658\uc728 \uc801\uc6a9 (1200\uc6d0 = 1\ub2ec\ub7ec)\n    op.execute('''\n        UPDATE products\n        SET price_usd = ROUND(price_krw / 1200.0, 2)\n    ''')\n\n    # 3. NOT NULL \uc81c\uc57d \ucd94\uac00\n    op.alter_column('products', 'price_usd', nullable=False)\n\n    # 4. \uae30\uc874 \uceec\ub7fc \uc0ad\uc81c\n    op.drop_column('products', 'price_krw')\n\n    # 5. \uceec\ub7fc \uc774\ub984 \ubcc0\uacbd\n    op.alter_column('products', 'price_usd', new_column_name='price')\n\ndef downgrade():\n    op.alter_column('products', 'price', new_column_name='price_usd')\n    op.add_column('products', sa.Column('price_krw', sa.Integer()))\n    op.execute('UPDATE products SET price_krw = ROUND(price_usd * 1200)')\n    op.drop_column('products', 'price_usd')\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\uc608\uc81c-2-\uc0c1\ud0dc-\uac12-\ubcc0\uacbd",children:"\uc608\uc81c 2: \uc0c1\ud0dc \uac12 \ubcc0\uacbd"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"\"\"\"standardize order status values\n\nRevision ID: status001\n\"\"\"\n\ndef upgrade():\n    # 1. \uc0c8 \uceec\ub7fc \ucd94\uac00\n    op.add_column('orders',\n        sa.Column('status_new', sa.String(20))\n    )\n\n    # 2. \ub370\uc774\ud130 \ubcc0\ud658\n    op.execute('''\n        UPDATE orders\n        SET status_new = CASE\n            WHEN status = '\ub300\uae30' THEN 'pending'\n            WHEN status = '\ucc98\ub9ac\uc911' THEN 'processing'\n            WHEN status = '\ubc30\uc1a1\uc911' THEN 'shipping'\n            WHEN status = '\uc644\ub8cc' THEN 'completed'\n            WHEN status = '\ucde8\uc18c' THEN 'cancelled'\n            ELSE 'pending'\n        END\n    ''')\n\n    # 3. \uc81c\uc57d\uc870\uac74 \ucd94\uac00\n    op.create_check_constraint(\n        'check_status_values',\n        'orders',\n        \"status_new IN ('pending', 'processing', 'shipping', 'completed', 'cancelled')\"\n    )\n\n    # 4. \uae30\uc874 \uceec\ub7fc \uc0ad\uc81c\n    op.drop_column('orders', 'status')\n\n    # 5. \uc774\ub984 \ubcc0\uacbd\n    op.alter_column('orders', 'status_new', new_column_name='status')\n\ndef downgrade():\n    op.alter_column('orders', 'status', new_column_name='status_new')\n    op.add_column('orders', sa.Column('status', sa.String(20)))\n    op.execute('''\n        UPDATE orders\n        SET status = CASE\n            WHEN status_new = 'pending' THEN '\ub300\uae30'\n            WHEN status_new = 'processing' THEN '\ucc98\ub9ac\uc911'\n            WHEN status_new = 'shipping' THEN '\ubc30\uc1a1\uc911'\n            WHEN status_new = 'completed' THEN '\uc644\ub8cc'\n            WHEN status_new = 'cancelled' THEN '\ucde8\uc18c'\n        END\n    ''')\n    op.drop_constraint('check_status_values', 'orders')\n    op.drop_column('orders', 'status_new')\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\uc608\uc81c-3-\uc815\uaddc\ud654---\ud14c\uc774\ube14-\ubd84\ub9ac",children:"\uc608\uc81c 3: \uc815\uaddc\ud654 - \ud14c\uc774\ube14 \ubd84\ub9ac"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"\"\"\"normalize user addresses to separate table\n\nRevision ID: normalize001\n\"\"\"\n\ndef upgrade():\n    # 1. \uc0c8 \uc8fc\uc18c \ud14c\uc774\ube14 \uc0dd\uc131\n    op.create_table(\n        'addresses',\n        sa.Column('id', sa.Integer(), primary_key=True),\n        sa.Column('user_id', sa.Integer(), nullable=False),\n        sa.Column('street', sa.String(200)),\n        sa.Column('city', sa.String(100)),\n        sa.Column('zip_code', sa.String(10)),\n        sa.Column('is_primary', sa.Boolean(), default=True),\n        sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE')\n    )\n\n    # 2. \uae30\uc874 \ub370\uc774\ud130 \uc774\ub3d9\n    op.execute('''\n        INSERT INTO addresses (user_id, street, city, zip_code, is_primary)\n        SELECT id, address, city, zip_code, true\n        FROM users\n        WHERE address IS NOT NULL\n    ''')\n\n    # 3. \uae30\uc874 \uceec\ub7fc \uc0ad\uc81c\n    op.drop_column('users', 'zip_code')\n    op.drop_column('users', 'city')\n    op.drop_column('users', 'address')\n\ndef downgrade():\n    op.add_column('users', sa.Column('address', sa.String(200)))\n    op.add_column('users', sa.Column('city', sa.String(100)))\n    op.add_column('users', sa.Column('zip_code', sa.String(10)))\n\n    op.execute('''\n        UPDATE users u\n        SET address = a.street,\n            city = a.city,\n            zip_code = a.zip_code\n        FROM addresses a\n        WHERE a.user_id = u.id AND a.is_primary = true\n    ''')\n\n    op.drop_table('addresses')\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-python-\ucf54\ub4dc-\uc0ac\uc6a9",children:"\ud83d\udc0d Python \ucf54\ub4dc \uc0ac\uc6a9"}),"\n",(0,r.jsx)(e.h3,{id:"bind\ub97c-\ud1b5\ud55c-\uc9c1\uc811-sql-\uc2e4\ud589",children:"bind\ub97c \ud1b5\ud55c \uc9c1\uc811 SQL \uc2e4\ud589"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from alembic import op\nimport sqlalchemy as sa\n\ndef upgrade():\n    # Connection \uac1d\uccb4 \uac00\uc838\uc624\uae30\n    conn = op.get_bind()\n\n    # \ub370\uc774\ud130 \uc870\ud68c\n    result = conn.execute(sa.text('SELECT id, old_field FROM users'))\n\n    # \uac01 \ud589 \ucc98\ub9ac\n    for row in result:\n        new_value = process_data(row['old_field'])\n        conn.execute(\n            sa.text('UPDATE users SET new_field = :val WHERE id = :id'),\n            {'val': new_value, 'id': row['id']}\n        )\n"})}),"\n",(0,r.jsx)(e.h3,{id:"bulk_insert_mappings-\uc0ac\uc6a9",children:"bulk_insert_mappings \uc0ac\uc6a9"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    conn = op.get_bind()\n    from sqlalchemy.orm import Session\n    session = Session(bind=conn)\n\n    # \ub300\ub7c9 \ub370\uc774\ud130 \uc0bd\uc785\n    data = [\n        {'name': 'Admin', 'role': 'admin'},\n        {'name': 'User', 'role': 'user'},\n        {'name': 'Guest', 'role': 'guest'},\n    ]\n\n    session.execute(\n        sa.insert(sa.table('roles',\n            sa.column('name'),\n            sa.column('role')\n        )),\n        data\n    )\n    session.commit()\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\ub300\ub7c9-\ub370\uc774\ud130-\ucc98\ub9ac",children:"\ud83d\udcca \ub300\ub7c9 \ub370\uc774\ud130 \ucc98\ub9ac"}),"\n",(0,r.jsx)(e.h3,{id:"\ubc30\uce58-\ucc98\ub9ac",children:"\ubc30\uce58 \ucc98\ub9ac"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"\"\"\"process large dataset in batches\n\nRevision ID: batch001\n\"\"\"\n\ndef upgrade():\n    conn = op.get_bind()\n    batch_size = 1000\n    offset = 0\n\n    while True:\n        # \ubc30\uce58 \ub2e8\uc704\ub85c \uc870\ud68c\n        result = conn.execute(sa.text(f'''\n            SELECT id, old_value\n            FROM products\n            ORDER BY id\n            LIMIT {batch_size} OFFSET {offset}\n        '''))\n\n        rows = result.fetchall()\n        if not rows:\n            break\n\n        # \ubc30\uce58 \ucc98\ub9ac\n        for row in rows:\n            new_value = row['old_value'] * 1.1  # 10% \uc778\uc0c1\n            conn.execute(sa.text('''\n                UPDATE products\n                SET new_value = :val\n                WHERE id = :id\n            '''), {'val': new_value, 'id': row['id']})\n\n        offset += batch_size\n\n        # \uc9c4\ud589\uc0c1\ud669 \ucd9c\ub825\n        print(f\"Processed {offset} rows...\")\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\ud2b8\ub79c\uc7ad\uc158-\uad00\ub9ac",children:"\ud2b8\ub79c\uc7ad\uc158 \uad00\ub9ac"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    conn = op.get_bind()\n\n    # \ud2b8\ub79c\uc7ad\uc158 \uc2dc\uc791\n    trans = conn.begin()\n\n    try:\n        # 1. \ubc31\uc5c5 \ud14c\uc774\ube14 \uc0dd\uc131\n        conn.execute(sa.text('''\n            CREATE TABLE users_backup AS\n            SELECT * FROM users\n        '''))\n\n        # 2. \ub370\uc774\ud130 \ubcc0\ud658\n        conn.execute(sa.text('''\n            UPDATE users\n            SET email = LOWER(email)\n        '''))\n\n        # 3. \uac80\uc99d\n        result = conn.execute(sa.text('''\n            SELECT COUNT(*) FROM users\n            WHERE email != LOWER(email)\n        '''))\n        if result.scalar() > 0:\n            raise Exception(\"Email conversion failed!\")\n\n        # \uc131\uacf5 \uc2dc \ucee4\ubc0b\n        trans.commit()\n\n        # \ubc31\uc5c5 \uc0ad\uc81c\n        conn.execute(sa.text('DROP TABLE users_backup'))\n\n    except Exception as e:\n        # \uc2e4\ud328 \uc2dc \ub864\ubc31\n        trans.rollback()\n        raise e\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",children:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d"}),"\n",(0,r.jsx)(e.h3,{id:"1-\ub370\uc774\ud130-\uc190\uc2e4-\ubc29\uc9c0",children:"1. \ub370\uc774\ud130 \uc190\uc2e4 \ubc29\uc9c0"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    # \u274c \uc704\ud5d8: \ub370\uc774\ud130 \uc190\uc2e4\n    op.drop_column('users', 'important_data')\n\n    # \u2705 \uc548\uc804: \ubc31\uc5c5 \uba3c\uc800\n    # 1. \ubc31\uc5c5 \ud14c\uc774\ube14\n    op.execute('CREATE TABLE users_backup AS SELECT * FROM users')\n\n    # 2. \uc791\uc5c5 \uc218\ud589\n    op.drop_column('users', 'important_data')\n\n    # 3. \ub098\uc911\uc5d0 \ubc31\uc5c5 \ud14c\uc774\ube14 \uc0ad\uc81c (\uc218\ub3d9)\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-null-\uac12-\ucc98\ub9ac",children:"2. NULL \uac12 \ucc98\ub9ac"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    # NULL \uac12 \ucc98\ub9ac\n    op.execute('''\n        UPDATE users\n        SET full_name = COALESCE(first_name || ' ' || last_name, 'Unknown')\n        WHERE full_name IS NULL\n    ''')\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\uc131\ub2a5-\uace0\ub824",children:"3. \uc131\ub2a5 \uace0\ub824"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def upgrade():\n    # \u274c \ub290\ub9bc: \ud55c \ubc88\uc5d0 \ubaa8\ub4e0 \ud589\n    op.execute('UPDATE products SET price = price * 1.1')\n\n    # \u2705 \ube60\ub984: \uc778\ub371\uc2a4 \ud65c\uc6a9\n    op.create_index('idx_temp', 'products', ['category_id'])\n    op.execute('''\n        UPDATE products\n        SET price = price * 1.1\n        WHERE category_id = 1\n    ''')\n    op.drop_index('idx_temp')\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\uc2e4\uc2b5-\uacfc\uc81c",children:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c"}),"\n",(0,r.jsx)(e.p,{children:"\ube14\ub85c\uadf8 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ub2e4\uc74c \ub370\uc774\ud130 \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc744 \uad6c\ud604\ud558\uc138\uc694:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"posts \ud14c\uc774\ube14\uc5d0 view_count\uac00 \ubb38\uc790\uc5f4\ub85c \uc800\uc7a5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4"}),"\n",(0,r.jsx)(e.li,{children:"\uc774\ub97c Integer\ub85c \ubcc0\ud658\ud558\ub418, \uc22b\uc790\uac00 \uc544\ub2cc \uac12\uc740 0\uc73c\ub85c \uc124\uc815"}),"\n",(0,r.jsx)(e.li,{children:"\uc74c\uc218 \uac12\ub3c4 0\uc73c\ub85c \ubcc0\uacbd"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"\uc815\ub2f5 \ubcf4\uae30"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"\"\"\"convert view_count to integer\n\nRevision ID: views001\n\"\"\"\n\ndef upgrade():\n    # 1. \uc0c8 \uceec\ub7fc \ucd94\uac00\n    op.add_column('posts',\n        sa.Column('view_count_int', sa.Integer())\n    )\n\n    # 2. \uc22b\uc790 \ubcc0\ud658 (PostgreSQL)\n    op.execute('''\n        UPDATE posts\n        SET view_count_int = CASE\n            WHEN view_count ~ '^[0-9]+$' THEN CAST(view_count AS INTEGER)\n            ELSE 0\n        END\n    ''')\n\n    # 3. \uc74c\uc218\ub97c 0\uc73c\ub85c\n    op.execute('''\n        UPDATE posts\n        SET view_count_int = 0\n        WHERE view_count_int < 0\n    ''')\n\n    # 4. NOT NULL \uc81c\uc57d \ucd94\uac00\n    op.alter_column('posts', 'view_count_int',\n        nullable=False,\n        server_default='0'\n    )\n\n    # 5. \uae30\uc874 \uceec\ub7fc \uc0ad\uc81c\n    op.drop_column('posts', 'view_count')\n\n    # 6. \uc774\ub984 \ubcc0\uacbd\n    op.alter_column('posts', 'view_count_int',\n        new_column_name='view_count'\n    )\n\ndef downgrade():\n    op.alter_column('posts', 'view_count',\n        new_column_name='view_count_int'\n    )\n    op.add_column('posts',\n        sa.Column('view_count', sa.String(20))\n    )\n    op.execute('''\n        UPDATE posts\n        SET view_count = CAST(view_count_int AS VARCHAR)\n    ''')\n    op.drop_column('posts', 'view_count_int')\n"})})]}),"\n",(0,r.jsx)(e.h2,{id:"-\ud575\uc2ec-\uc815\ub9ac",children:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"op.execute()"}),": SQL \uc9c1\uc811 \uc2e4\ud589"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"op.get_bind()"}),": Connection \uac1d\uccb4 \ud68d\ub4dd"]}),"\n",(0,r.jsx)(e.li,{children:"\ub370\uc774\ud130 \ubcc0\ud658 \uc2dc \ud56d\uc0c1 \ubc31\uc5c5 \uc0dd\uc131"}),"\n",(0,r.jsx)(e.li,{children:"\ub300\ub7c9 \ub370\uc774\ud130\ub294 \ubc30\uce58 \ucc98\ub9ac"}),"\n",(0,r.jsx)(e.li,{children:"NULL \uac12, \ud0c0\uc785 \ubcc0\ud658 \uc8fc\uc758"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"-\ub2e4\uc74c-\ub2e8\uacc4",children:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4"}),"\n",(0,r.jsxs)(e.p,{children:["\ud83d\udc49 ",(0,r.jsx)(e.a,{href:"./branching",children:"\ube0c\ub79c\uce58\uc640 \ubcd1\ud569"})]})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>a,x:()=>i});var o=s(6540);const r={},t=o.createContext(r);function a(n){const e=o.useContext(t);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),o.createElement(t.Provider,{value:e},n.children)}}}]);