<!doctype html>
<html lang="ko" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-prometheus/promql" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">3. PromQL 쿼리 | docusaurus-comp-2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/prometheus/promql"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3. PromQL 쿼리 | docusaurus-comp-2"><meta data-rh="true" name="description" content="PromQL(Prometheus Query Language)은 Prometheus의 시계열 데이터를 조회하고 분석하기 위한 강력한 쿼리 언어입니다. 이 문서에서는 PromQL의 기본부터 고급 활용까지 상세히 다룹니다."><meta data-rh="true" property="og:description" content="PromQL(Prometheus Query Language)은 Prometheus의 시계열 데이터를 조회하고 분석하기 위한 강력한 쿼리 언어입니다. 이 문서에서는 PromQL의 기본부터 고급 활용까지 상세히 다룹니다."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/prometheus/promql"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/prometheus/promql" hreflang="ko"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/prometheus/promql" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"3. PromQL 쿼리","item":"https://your-docusaurus-site.example.com/docs/prometheus/promql"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="docusaurus-comp-2 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="docusaurus-comp-2 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.85698258.css">
<script src="/assets/js/runtime~main.daf981ad.js" defer="defer"></script>
<script src="/assets/js/main.6bf97251.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">docusaurus-comp-2</b></a><a class="navbar__item navbar__link" href="/docs/">GitHub</a><a class="navbar__item navbar__link" href="/docs/writing/intro">Writing</a><a class="navbar__item navbar__link" href="/docs/python/advanced/metaclasses">Python</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/prometheus/installation">Prometheus</a><a class="navbar__item navbar__link" href="/docs/n8n/installation">n8n</a><a class="navbar__item navbar__link" href="/docs/pandas/basics">pandas</a><a class="navbar__item navbar__link" href="/docs/webapp/intro">Web App</a><a class="navbar__item navbar__link" href="/docs/dagster/intro">Dagster</a><a class="navbar__item navbar__link" href="/docs/apscheduler/intro">APScheduler</a><a class="navbar__item navbar__link" href="/docs/enterprise/intro">Enterprise App</a><a class="navbar__item navbar__link" href="/docs/webdev/intro">Web Dev</a><a class="navbar__item navbar__link" href="/docs/devops/intro">DevOps</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="맨 위로 스크롤하기" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="문서 사이드바" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/installation"><span title="1. 설치 및 설정" class="linkLabel_WmDU">1. 설치 및 설정</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/metrics"><span title="2. 메트릭과 Python 클라이언트" class="linkLabel_WmDU">2. 메트릭과 Python 클라이언트</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/prometheus/promql"><span title="3. PromQL 쿼리" class="linkLabel_WmDU">3. PromQL 쿼리</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/grafana"><span title="4. Grafana 연동" class="linkLabel_WmDU">4. Grafana 연동</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/alerting"><span title="5. Alerting" class="linkLabel_WmDU">5. Alerting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/examples"><span title="6. 실전 예제" class="linkLabel_WmDU">6. 실전 예제</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prometheus/intro"><span title="Prometheus 모니터링 가이드" class="linkLabel_WmDU">Prometheus 모니터링 가이드</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="탐색 경로"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="홈" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">3. PromQL 쿼리</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">이 페이지에서</button></div><div class="theme-doc-markdown markdown"><header><h1>3. PromQL 쿼리</h1></header>
<p>PromQL(Prometheus Query Language)은 Prometheus의 시계열 데이터를 조회하고 분석하기 위한 강력한 쿼리 언어입니다. 이 문서에서는 PromQL의 기본부터 고급 활용까지 상세히 다룹니다.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-promql-기본-개념">3.1 PromQL 기본 개념<a href="#31-promql-기본-개념" class="hash-link" aria-label="3.1 PromQL 기본 개념에 대한 직접 링크" title="3.1 PromQL 기본 개념에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="시계열-데이터-이해">시계열 데이터 이해<a href="#시계열-데이터-이해" class="hash-link" aria-label="시계열 데이터 이해에 대한 직접 링크" title="시계열 데이터 이해에 대한 직접 링크" translate="no">​</a></h3>
<p>Prometheus는 <strong>시계열(time series)</strong> 데이터베이스입니다. 각 시계열은 다음과 같이 구성됩니다:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;metric name&gt;{&lt;label name&gt;=&lt;label value&gt;, ...}</span><br></span></code></pre></div></div>
<p><strong>예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=&quot;GET&quot;, endpoint=&quot;/api/users&quot;, status=&quot;200&quot;}</span><br></span></code></pre></div></div>
<p>이 시계열은:</p>
<ul>
<li class=""><strong>Metric name</strong>: <code>http_requests_total</code></li>
<li class=""><strong>Labels</strong>:<!-- -->
<ul>
<li class=""><code>method=&quot;GET&quot;</code></li>
<li class=""><code>endpoint=&quot;/api/users&quot;</code></li>
<li class=""><code>status=&quot;200&quot;</code></li>
</ul>
</li>
</ul>
<p>각 시계열은 타임스탬프와 함께 값(value)을 저장합니다.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="데이터-타입">데이터 타입<a href="#데이터-타입" class="hash-link" aria-label="데이터 타입에 대한 직접 링크" title="데이터 타입에 대한 직접 링크" translate="no">​</a></h3>
<p>PromQL은 4가지 데이터 타입을 지원합니다:</p>
<ol>
<li class=""><strong>Instant Vector</strong>: 특정 시점의 시계열 집합</li>
<li class=""><strong>Range Vector</strong>: 시간 범위에 걸친 시계열 집합</li>
<li class=""><strong>Scalar</strong>: 단순 숫자 값</li>
<li class=""><strong>String</strong>: 문자열 값 (현재는 제한적으로 사용)</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-selectors-선택자">3.2 Selectors (선택자)<a href="#32-selectors-선택자" class="hash-link" aria-label="3.2 Selectors (선택자)에 대한 직접 링크" title="3.2 Selectors (선택자)에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="instant-vector-selectors">Instant Vector Selectors<a href="#instant-vector-selectors" class="hash-link" aria-label="Instant Vector Selectors에 대한 직접 링크" title="Instant Vector Selectors에 대한 직접 링크" translate="no">​</a></h3>
<p>특정 시점의 시계열을 선택합니다.</p>
<p><strong>기본 선택:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 모든 http_requests_total 메트릭</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 레이블로 필터링</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=&quot;GET&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 여러 레이블 조건</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=&quot;GET&quot;, status=&quot;200&quot;}</span><br></span></code></pre></div></div>
<p><strong>레이블 매칭 연산자:</strong></p>
<table><thead><tr><th>연산자</th><th>설명</th><th>예시</th></tr></thead><tbody><tr><td><code>=</code></td><td>정확히 일치</td><td><code>method=&quot;GET&quot;</code></td></tr><tr><td><code>!=</code></td><td>일치하지 않음</td><td><code>status!=&quot;500&quot;</code></td></tr><tr><td><code>=~</code></td><td>정규식 일치</td><td><code>endpoint=~&quot;/api/.*&quot;</code></td></tr><tr><td><code>!~</code></td><td>정규식 불일치</td><td><code>endpoint!~&quot;/internal/.*&quot;</code></td></tr></tbody></table>
<p><strong>예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 모든 GET, POST 요청</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=~&quot;GET|POST&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 5xx 상태 코드 제외</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{status!~&quot;5..&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># /api/로 시작하는 엔드포인트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{endpoint=~&quot;/api/.*&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 여러 조건 조합</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=&quot;GET&quot;, status=~&quot;2..&quot;, endpoint!~&quot;/health&quot;}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="range-vector-selectors">Range Vector Selectors<a href="#range-vector-selectors" class="hash-link" aria-label="Range Vector Selectors에 대한 직접 링크" title="Range Vector Selectors에 대한 직접 링크" translate="no">​</a></h3>
<p>시간 범위에 걸친 시계열을 선택합니다.</p>
<p><strong>문법:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;metric_name&gt;{&lt;label_selectors&gt;}[&lt;duration&gt;]</span><br></span></code></pre></div></div>
<p><strong>시간 단위:</strong></p>
<ul>
<li class=""><code>s</code> - 초 (seconds)</li>
<li class=""><code>m</code> - 분 (minutes)</li>
<li class=""><code>h</code> - 시간 (hours)</li>
<li class=""><code>d</code> - 일 (days)</li>
<li class=""><code>w</code> - 주 (weeks)</li>
<li class=""><code>y</code> - 년 (years)</li>
</ul>
<p><strong>예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 5분간의 데이터</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total[5m]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1시간 데이터</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cpu_usage[1h]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1일 데이터</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">memory_usage[1d]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 조합</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{method=&quot;GET&quot;}[5m]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="offset-modifier">Offset Modifier<a href="#offset-modifier" class="hash-link" aria-label="Offset Modifier에 대한 직접 링크" title="Offset Modifier에 대한 직접 링크" translate="no">​</a></h3>
<p>과거 특정 시점의 데이터를 조회합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1시간 전의 값</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total offset 1h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1일 전의 5분 범위 데이터</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total[5m] offset 1d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 값과 1시간 전 값 비교</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total - http_requests_total offset 1h</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-operators-연산자">3.3 Operators (연산자)<a href="#33-operators-연산자" class="hash-link" aria-label="3.3 Operators (연산자)에 대한 직접 링크" title="3.3 Operators (연산자)에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="arithmetic-operators-산술-연산자">Arithmetic Operators (산술 연산자)<a href="#arithmetic-operators-산술-연산자" class="hash-link" aria-label="Arithmetic Operators (산술 연산자)에 대한 직접 링크" title="Arithmetic Operators (산술 연산자)에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+  # 덧셈</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-  # 뺄셈</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*  # 곱셈</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/  # 나눗셈</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">%  # 나머지</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">^  # 거듭제곱</span><br></span></code></pre></div></div>
<p><strong>예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률을 퍼센트로 변환</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_cpu_seconds_total * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메모리 사용률 계산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 초당 요청 수를 분당으로 변환</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m]) * 60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 거듭제곱</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total ^ 2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="comparison-operators-비교-연산자">Comparison Operators (비교 연산자)<a href="#comparison-operators-비교-연산자" class="hash-link" aria-label="Comparison Operators (비교 연산자)에 대한 직접 링크" title="Comparison Operators (비교 연산자)에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">==  # 같음</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">!=  # 다름</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;   # 초과</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;   # 미만</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;=  # 이상</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;=  # 이하</span><br></span></code></pre></div></div>
<p><strong>기본 동작</strong>: 비교 연산자는 필터링으로 작동합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률이 80% 이상인 것만</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_cpu_usage &gt; 80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메모리 사용률이 90% 미만인 것만</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_usage &lt; 90</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 응답 시간이 1초 이상인 요청</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_request_duration_seconds &gt; 1</span><br></span></code></pre></div></div>
<p><strong>bool 수정자</strong>: 0 또는 1을 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 조건을 만족하면 1, 아니면 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total &gt; bool 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="logical-operators-논리-연산자">Logical Operators (논리 연산자)<a href="#logical-operators-논리-연산자" class="hash-link" aria-label="Logical Operators (논리 연산자)에 대한 직접 링크" title="Logical Operators (논리 연산자)에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">and  # AND 연산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or   # OR 연산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unless  # UNLESS 연산 (제외)</span><br></span></code></pre></div></div>
<p><strong>예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률 &gt; 80% AND 메모리 사용률 &gt; 90%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_cpu_usage &gt; 80 and node_memory_usage &gt; 90</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 에러 또는 타임아웃 요청</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{status=&quot;500&quot;} or http_requests_total{status=&quot;timeout&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 모든 인스턴스 중 다운된 인스턴스 제외</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">up unless up == 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="vector-matching">Vector Matching<a href="#vector-matching" class="hash-link" aria-label="Vector Matching에 대한 직접 링크" title="Vector Matching에 대한 직접 링크" translate="no">​</a></h3>
<p>벡터 간 연산 시 레이블 매칭 방식을 제어합니다.</p>
<p><strong>One-to-One Matching:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 기본 매칭 (모든 레이블이 일치해야 함)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">method_code:http_errors:rate5m / method_code:http_requests:rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 레이블만 매칭 (on)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">method_code:http_errors:rate5m / on(method, code) method_code:http_requests:rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 레이블 무시 (ignoring)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">method_code:http_errors:rate5m / ignoring(instance) method_code:http_requests:rate5m</span><br></span></code></pre></div></div>
<p><strong>Many-to-One / One-to-Many Matching:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># group_left: 왼쪽이 많은 쪽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">method_code:http_errors:rate5m / on(method) group_left http_requests_total</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># group_right: 오른쪽이 많은 쪽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total / on(method) group_right method_code:http_errors:rate5m</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="34-functions-함수">3.4 Functions (함수)<a href="#34-functions-함수" class="hash-link" aria-label="3.4 Functions (함수)에 대한 직접 링크" title="3.4 Functions (함수)에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rate-functions">Rate Functions<a href="#rate-functions" class="hash-link" aria-label="Rate Functions에 대한 직접 링크" title="Rate Functions에 대한 직접 링크" translate="no">​</a></h3>
<p>Counter 메트릭의 초당 평균 증가율을 계산합니다.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="rate">rate()<a href="#rate" class="hash-link" aria-label="rate()에 대한 직접 링크" title="rate()에 대한 직접 링크" translate="no">​</a></h4>
<p>지정된 시간 범위에서 초당 평균 증가율을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 5분간 초당 평균 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1분간 CPU 사용 시간의 초당 증가율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(node_cpu_seconds_total[1m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 엔드포인트의 초당 에러 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total{status=~&quot;5..&quot;, endpoint=&quot;/api/users&quot;}[5m])</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>권장사항</div><div class="admonitionContent_BuS1"><p><code>rate()</code>는 최소 4배 이상의 scrape interval을 사용하는 것이 좋습니다. scrape interval이 15초라면 최소 <code>[1m]</code>을 사용하세요.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="irate">irate()<a href="#irate" class="hash-link" aria-label="irate()에 대한 직접 링크" title="irate()에 대한 직접 링크" translate="no">​</a></h4>
<p>마지막 두 데이터 포인트를 사용하여 순간 증가율을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 순간 요청 비율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">irate(http_requests_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 순간 CPU 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">irate(node_cpu_seconds_total[5m])</span><br></span></code></pre></div></div>
<p><strong>rate() vs irate():</strong></p>
<ul>
<li class=""><code>rate()</code>: 장기 트렌드, 안정적인 값</li>
<li class=""><code>irate()</code>: 단기 변화, 민감한 값 (스파이크 감지에 유용)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="increase">increase()<a href="#increase" class="hash-link" aria-label="increase()에 대한 직접 링크" title="increase()에 대한 직접 링크" translate="no">​</a></h4>
<p>지정된 시간 범위에서 총 증가량을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1시간 동안 총 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">increase(http_requests_total[1h])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 24시간 동안 에러 증가량</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">increase(http_requests_total{status=~&quot;5..&quot;}[24h])</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>팁</div><div class="admonitionContent_BuS1"><p><code>increase(metric[5m])</code> = <code>rate(metric[5m]) * 5 * 60</code></p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aggregation-functions">Aggregation Functions<a href="#aggregation-functions" class="hash-link" aria-label="Aggregation Functions에 대한 직접 링크" title="Aggregation Functions에 대한 직접 링크" translate="no">​</a></h3>
<p>여러 시계열을 집계합니다.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sum">sum()<a href="#sum" class="hash-link" aria-label="sum()에 대한 직접 링크" title="sum()에 대한 직접 링크" translate="no">​</a></h4>
<p>합계를 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 모든 인스턴스의 총 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(http_requests_total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메서드별 총 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (method) (http_requests_total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메서드를 제외한 그룹별 총합</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum without (method) (http_requests_total)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="avg">avg()<a href="#avg" class="hash-link" aria-label="avg()에 대한 직접 링크" title="avg()에 대한 직접 링크" translate="no">​</a></h4>
<p>평균을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 전체 평균 CPU 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg(node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 인스턴스별 평균 CPU 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg by (instance) (node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 환경별 평균 메모리 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg by (environment) (node_memory_usage)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count">count()<a href="#count" class="hash-link" aria-label="count()에 대한 직접 링크" title="count()에 대한 직접 링크" translate="no">​</a></h4>
<p>시계열 개수를 셉니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 총 인스턴스 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count(up)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 정상 작동 중인 인스턴스 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count(up == 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 인스턴스 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count by (service) (up)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="min--max">min() / max()<a href="#min--max" class="hash-link" aria-label="min() / max()에 대한 직접 링크" title="min() / max()에 대한 직접 링크" translate="no">​</a></h4>
<p>최솟값 / 최댓값을 찾습니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 가장 낮은 CPU 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">min(node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 가장 높은 메모리 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max(node_memory_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 최대 응답 시간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max by (service) (http_request_duration_seconds)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="stddev--stdvar">stddev() / stdvar()<a href="#stddev--stdvar" class="hash-link" aria-label="stddev() / stdvar()에 대한 직접 링크" title="stddev() / stdvar()에 대한 직접 링크" translate="no">​</a></h4>
<p>표준편차 / 분산을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률 표준편차</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stddev(node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 응답 시간의 분산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stdvar(http_request_duration_seconds)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="topk--bottomk">topk() / bottomk()<a href="#topk--bottomk" class="hash-link" aria-label="topk() / bottomk()에 대한 직접 링크" title="topk() / bottomk()에 대한 직접 링크" translate="no">​</a></h4>
<p>상위 / 하위 K개 시계열을 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률 상위 5개 인스턴스</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topk(5, node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 요청 수 하위 3개 엔드포인트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bottomk(3, rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 에러율 상위 10개 서비스</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topk(10,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (service) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (service) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="quantile">quantile()<a href="#quantile" class="hash-link" aria-label="quantile()에 대한 직접 링크" title="quantile()에 대한 직접 링크" translate="no">​</a></h4>
<p>분위수를 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 50th percentile (중앙값)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quantile(0.5, http_request_duration_seconds)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 95th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quantile(0.95, http_request_duration_seconds)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 99th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quantile(0.99, http_request_duration_seconds)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 95th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quantile by (service) (0.95, http_request_duration_seconds)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="time-functions">Time Functions<a href="#time-functions" class="hash-link" aria-label="Time Functions에 대한 직접 링크" title="Time Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="time">time()<a href="#time" class="hash-link" aria-label="time()에 대한 직접 링크" title="time()에 대한 직접 링크" translate="no">​</a></h4>
<p>현재 Unix 타임스탬프를 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 시간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">time()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메트릭이 마지막으로 수집된 이후 경과 시간 (초)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">time() - timestamp(metric_name)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="timestamp">timestamp()<a href="#timestamp" class="hash-link" aria-label="timestamp()에 대한 직접 링크" title="timestamp()에 대한 직접 링크" translate="no">​</a></h4>
<p>샘플의 타임스탬프를 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">timestamp(up)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="day_of_week">day_of_week()<a href="#day_of_week" class="hash-link" aria-label="day_of_week()에 대한 직접 링크" title="day_of_week()에 대한 직접 링크" translate="no">​</a></h4>
<p>요일을 반환합니다 (0=일요일, 6=토요일).</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 주말인지 확인 (0 또는 6이면 주말)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">day_of_week()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 주말 동안의 트래픽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m]) and day_of_week() &gt; 0 &lt; 6</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="hour">hour()<a href="#hour" class="hash-link" aria-label="hour()에 대한 직접 링크" title="hour()에 대한 직접 링크" translate="no">​</a></h4>
<p>시간을 반환합니다 (0-23).</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 시간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hour()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 업무 시간(9-18시) 동안의 메트릭</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m]) and hour() &gt;= 9 &lt;= 18</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="mathematical-functions">Mathematical Functions<a href="#mathematical-functions" class="hash-link" aria-label="Mathematical Functions에 대한 직접 링크" title="Mathematical Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="abs">abs()<a href="#abs" class="hash-link" aria-label="abs()에 대한 직접 링크" title="abs()에 대한 직접 링크" translate="no">​</a></h4>
<p>절댓값을 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">abs(delta(http_requests_total[5m]))</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ceil--floor--round">ceil() / floor() / round()<a href="#ceil--floor--round" class="hash-link" aria-label="ceil() / floor() / round()에 대한 직접 링크" title="ceil() / floor() / round()에 대한 직접 링크" translate="no">​</a></h4>
<p>올림 / 내림 / 반올림합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceil(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">floor(node_memory_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">round(cpu_usage_percent, 0.1)  # 소수점 첫째 자리</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="exp--ln--log2--log10">exp() / ln() / log2() / log10()<a href="#exp--ln--log2--log10" class="hash-link" aria-label="exp() / ln() / log2() / log10()에 대한 직접 링크" title="exp() / ln() / log2() / log10()에 대한 직접 링크" translate="no">​</a></h4>
<p>지수 / 자연로그 / 밑이 2인 로그 / 밑이 10인 로그</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">exp(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ln(http_response_size_bytes)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sqrt">sqrt()<a href="#sqrt" class="hash-link" aria-label="sqrt()에 대한 직접 링크" title="sqrt()에 대한 직접 링크" translate="no">​</a></h4>
<p>제곱근을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sqrt(http_requests_total)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="delta-and-derivative-functions">Delta and Derivative Functions<a href="#delta-and-derivative-functions" class="hash-link" aria-label="Delta and Derivative Functions에 대한 직접 링크" title="Delta and Derivative Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="delta">delta()<a href="#delta" class="hash-link" aria-label="delta()에 대한 직접 링크" title="delta()에 대한 직접 링크" translate="no">​</a></h4>
<p>Range vector의 첫 값과 마지막 값의 차이를 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 5분간 게이지 메트릭의 변화량</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delta(node_memory_available_bytes[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1시간 동안 온도 변화</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delta(temperature_celsius[1h])</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="idelta">idelta()<a href="#idelta" class="hash-link" aria-label="idelta()에 대한 직접 링크" title="idelta()에 대한 직접 링크" translate="no">​</a></h4>
<p>마지막 두 샘플의 차이를 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">idelta(node_memory_available_bytes[5m])</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deriv">deriv()<a href="#deriv" class="hash-link" aria-label="deriv()에 대한 직접 링크" title="deriv()에 대한 직접 링크" translate="no">​</a></h4>
<p>Range vector에서 선형 회귀를 사용한 초당 변화율을 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">deriv(node_memory_available_bytes[5m])</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prediction-functions">Prediction Functions<a href="#prediction-functions" class="hash-link" aria-label="Prediction Functions에 대한 직접 링크" title="Prediction Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="predict_linear">predict_linear()<a href="#predict_linear" class="hash-link" aria-label="predict_linear()에 대한 직접 링크" title="predict_linear()에 대한 직접 링크" translate="no">​</a></h4>
<p>선형 예측을 수행합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 추세로 4시간 후 디스크 사용량 예측</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">predict_linear(node_filesystem_free_bytes[1h], 4 * 3600)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1시간 후 메모리가 고갈될 것으로 예측되면 알림</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">predict_linear(node_memory_available_bytes[30m], 3600) &lt; 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="label-manipulation-functions">Label Manipulation Functions<a href="#label-manipulation-functions" class="hash-link" aria-label="Label Manipulation Functions에 대한 직접 링크" title="Label Manipulation Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="label_replace">label_replace()<a href="#label_replace" class="hash-link" aria-label="label_replace()에 대한 직접 링크" title="label_replace()에 대한 직접 링크" translate="no">​</a></h4>
<p>레이블 값을 변경하거나 새 레이블을 추가합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># instance 레이블에서 호스트 이름만 추출</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">label_replace(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  up,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;hostname&quot;,              # 새 레이블 이름</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;$1&quot;,                    # 추출할 값</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;instance&quot;,              # 소스 레이블</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;([^:]+):.*&quot;            # 정규식 패턴</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 포트 번호 추출</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">label_replace(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  up,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;port&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;$1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;instance&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;.*:(.*)&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="label_join">label_join()<a href="#label_join" class="hash-link" aria-label="label_join()에 대한 직접 링크" title="label_join()에 대한 직접 링크" translate="no">​</a></h4>
<p>여러 레이블을 결합합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># method와 status를 결합</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">label_join(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  http_requests_total,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;method_status&quot;,        # 새 레이블 이름</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;_&quot;,                    # 구분자</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;method&quot;,               # 소스 레이블 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;status&quot;                # 소스 레이블 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sorting-functions">Sorting Functions<a href="#sorting-functions" class="hash-link" aria-label="Sorting Functions에 대한 직접 링크" title="Sorting Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sort--sort_desc">sort() / sort_desc()<a href="#sort--sort_desc" class="hash-link" aria-label="sort() / sort_desc()에 대한 직접 링크" title="sort() / sort_desc()에 대한 직접 링크" translate="no">​</a></h4>
<p>오름차순 / 내림차순으로 정렬합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># CPU 사용률을 오름차순 정렬</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sort(node_cpu_usage)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메모리 사용률을 내림차순 정렬</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sort_desc(node_memory_usage)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="histogram-functions">Histogram Functions<a href="#histogram-functions" class="hash-link" aria-label="Histogram Functions에 대한 직접 링크" title="Histogram Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="histogram_quantile">histogram_quantile()<a href="#histogram_quantile" class="hash-link" aria-label="histogram_quantile()에 대한 직접 링크" title="histogram_quantile()에 대한 직접 링크" translate="no">​</a></h4>
<p>히스토그램에서 분위수를 계산합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 95th percentile 응답 시간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rate(http_request_duration_seconds_bucket[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 99th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0.99,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (service, le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="other-useful-functions">Other Useful Functions<a href="#other-useful-functions" class="hash-link" aria-label="Other Useful Functions에 대한 직접 링크" title="Other Useful Functions에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="absent">absent()<a href="#absent" class="hash-link" aria-label="absent()에 대한 직접 링크" title="absent()에 대한 직접 링크" translate="no">​</a></h4>
<p>메트릭이 없으면 1을 반환합니다 (알림에 유용).</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># API 서버가 메트릭을 보고하지 않으면 알림</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">absent(up{job=&quot;api-server&quot;})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 엔드포인트의 메트릭이 없으면 알림</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">absent(http_requests_total{endpoint=&quot;/critical&quot;})</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="changes">changes()<a href="#changes" class="hash-link" aria-label="changes()에 대한 직접 링크" title="changes()에 대한 직접 링크" translate="no">​</a></h4>
<p>Range vector에서 값이 변경된 횟수를 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 1시간 동안 재시작 횟수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">changes(process_start_time_seconds[1h])</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="resets">resets()<a href="#resets" class="hash-link" aria-label="resets()에 대한 직접 링크" title="resets()에 대한 직접 링크" translate="no">​</a></h4>
<p>Counter가 재설정된 횟수를 반환합니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">resets(http_requests_total[1h])</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="35-aggregation-operations">3.5 Aggregation Operations<a href="#35-aggregation-operations" class="hash-link" aria-label="3.5 Aggregation Operations에 대한 직접 링크" title="3.5 Aggregation Operations에 대한 직접 링크" translate="no">​</a></h2>
<p>집계 연산자는 여러 시계열을 하나 또는 여러 그룹으로 결합합니다.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="by와-without">by와 without<a href="#by와-without" class="hash-link" aria-label="by와 without에 대한 직접 링크" title="by와 without에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>by</strong>: 지정된 레이블로 그룹화
<strong>without</strong>: 지정된 레이블을 제외하고 그룹화</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메서드별로 그룹화</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (method) (http_requests_total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메서드와 상태코드별로 그룹화</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (method, status) (http_requests_total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># instance 레이블을 제외하고 그룹화</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum without (instance) (http_requests_total)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 여러 레이블 제외</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg without (instance, job) (node_cpu_usage)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="실전-집계-패턴">실전 집계 패턴<a href="#실전-집계-패턴" class="hash-link" aria-label="실전 집계 패턴에 대한 직접 링크" title="실전 집계 패턴에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>전체 클러스터 메트릭:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 클러스터 전체 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 클러스터 전체 에러율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span></code></pre></div></div>
<p><strong>서비스별 메트릭:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 요청 수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 평균 응답 시간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg by (service) (http_request_duration_seconds)</span><br></span></code></pre></div></div>
<p><strong>다차원 집계:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스와 환경별 에러율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service, environment) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service, environment) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메서드와 엔드포인트별 95th percentile 레이턴시</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (method, endpoint, le) (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rate(http_request_duration_seconds_bucket[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="36-recording-rules">3.6 Recording Rules<a href="#36-recording-rules" class="hash-link" aria-label="3.6 Recording Rules에 대한 직접 링크" title="3.6 Recording Rules에 대한 직접 링크" translate="no">​</a></h2>
<p>Recording rules는 자주 사용되거나 계산 비용이 높은 쿼리를 미리 계산하여 저장합니다.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="설정-방법">설정 방법<a href="#설정-방법" class="hash-link" aria-label="설정 방법에 대한 직접 링크" title="설정 방법에 대한 직접 링크" translate="no">​</a></h3>
<p><code>prometheus.yml</code>에 rules 파일을 지정합니다:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">rule_files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rules/*.yml&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recording-rule-작성">Recording Rule 작성<a href="#recording-rule-작성" class="hash-link" aria-label="Recording Rule 작성에 대한 직접 링크" title="Recording Rule 작성에 대한 직접 링크" translate="no">​</a></h3>
<p><code>rules/app_metrics.yml</code> 예시:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">groups</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> http_metrics</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 초당 요청 수</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">http_requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> sum by (job) (rate(http_requests_total</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">5m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 메서드별 요청 수</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> job_method</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">http_requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> sum by (job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> method) (rate(http_requests_total</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">5m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 에러율</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">http_errors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          sum by (job) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          sum by (job) (rate(http_requests_total[5m]))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 평균 응답 시간</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">http_request_duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">avg5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          sum by (job) (rate(http_request_duration_seconds_sum[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          sum by (job) (rate(http_request_duration_seconds_count[5m]))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> infrastructure_metrics</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 1m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 인스턴스별 CPU 사용률</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">node_cpu_utilization</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">rate5m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          100 - (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">            avg by (instance) (rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[5m])) * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 인스턴스별 메모리 사용률</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">node_memory_utilization</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">ratio</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">            node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          node_memory_MemTotal_bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)"># 디스크 사용률</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> instance_device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">node_disk_utilization</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">ratio</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">expr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token scalar string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">            node_filesystem_size_bytes - node_filesystem_avail_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token scalar string" style="color:rgb(255, 121, 198)">          node_filesystem_size_bytes</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="naming-convention">Naming Convention<a href="#naming-convention" class="hash-link" aria-label="Naming Convention에 대한 직접 링크" title="Naming Convention에 대한 직접 링크" translate="no">​</a></h3>
<p>Recording rules는 다음 네이밍 컨벤션을 따릅니다:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">level:metric:operations</span><br></span></code></pre></div></div>
<p><strong>예시:</strong></p>
<ul>
<li class=""><code>job:http_requests:rate5m</code> - job 레벨, 5분 rate</li>
<li class=""><code>instance:node_cpu:avg</code> - instance 레벨, 평균</li>
<li class=""><code>job_method:http_errors:rate5m</code> - job과 method 레벨, 5분 rate</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>모범 사례</div><div class="admonitionContent_BuS1"><ol>
<li class="">자주 사용하는 복잡한 쿼리를 recording rule로 만드세요</li>
<li class="">대시보드에서 반복되는 계산을 recording rule로 최적화하세요</li>
<li class="">네이밍 컨벤션을 일관되게 유지하세요</li>
<li class="">interval을 적절히 설정하여 리소스를 절약하세요</li>
</ol></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="37-실전-쿼리-패턴">3.7 실전 쿼리 패턴<a href="#37-실전-쿼리-패턴" class="hash-link" aria-label="3.7 실전 쿼리 패턴에 대한 직접 링크" title="3.7 실전 쿼리 패턴에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="에러율-error-rate">에러율 (Error Rate)<a href="#에러율-error-rate" class="hash-link" aria-label="에러율 (Error Rate)에 대한 직접 링크" title="에러율 (Error Rate)에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>기본 에러율:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 전체 에러율 (5xx 응답)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<p><strong>서비스별 에러율:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<p><strong>엔드포인트별 에러율 (상위 10개):</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">topk(10,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (endpoint) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (endpoint) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>4xx vs 5xx 비교:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 4xx 에러율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;4..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 5xx 에러율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>에러율 알림 기준</div><div class="admonitionContent_BuS1"><ul>
<li class="">Warning: 에러율 &gt; 1%</li>
<li class="">Critical: 에러율 &gt; 5%</li>
<li class="">최소 5분 이상 지속될 때 알림</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="레이턴시-latency">레이턴시 (Latency)<a href="#레이턴시-latency" class="hash-link" aria-label="레이턴시 (Latency)에 대한 직접 링크" title="레이턴시 (Latency)에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>평균 레이턴시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 전체 평균</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_request_duration_seconds_sum[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_request_duration_seconds_count[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 평균</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_request_duration_seconds_sum[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_request_duration_seconds_count[5m]))</span><br></span></code></pre></div></div>
<p><strong>Percentile 레이턴시 (히스토그램 사용):</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 50th percentile (중앙값)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.5,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 95th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 99th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.99,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>서비스별 Percentile:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 95th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (service, le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 엔드포인트별 99th percentile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.99,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (endpoint, le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>레이턴시 분포:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1초 이상 응답의 비율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_bucket{le=&quot;1&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_count[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>레이턴시 목표</div><div class="admonitionContent_BuS1"><ul>
<li class="">P50 &lt; 100ms</li>
<li class="">P95 &lt; 500ms</li>
<li class="">P99 &lt; 1000ms
(서비스 요구사항에 따라 조정)</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="처리량-throughput">처리량 (Throughput)<a href="#처리량-throughput" class="hash-link" aria-label="처리량 (Throughput)에 대한 직접 링크" title="처리량 (Throughput)에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>초당 요청 수 (RPS):</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 전체 RPS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 서비스별 RPS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 엔드포인트별 RPS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (endpoint) (rate(http_requests_total[5m]))</span><br></span></code></pre></div></div>
<p><strong>분당 요청 수 (RPM):</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m])) * 60</span><br></span></code></pre></div></div>
<p><strong>메서드별 처리량:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (method) (rate(http_requests_total[5m]))</span><br></span></code></pre></div></div>
<p><strong>성공 vs 실패 처리량:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 성공 (2xx, 3xx)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;[23]..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 실패 (4xx, 5xx)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;[45]..&quot;}[5m]))</span><br></span></code></pre></div></div>
<p><strong>피크 시간대 분석:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 시간대별 평균 처리량</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">avg_over_time(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m]))[1h:5m]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cpu-사용률">CPU 사용률<a href="#cpu-사용률" class="hash-link" aria-label="CPU 사용률에 대한 직접 링크" title="CPU 사용률에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>인스턴스별 CPU 사용률:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[5m])) * 100)</span><br></span></code></pre></div></div>
<p><strong>전체 클러스터 평균 CPU:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">100 - (avg(rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[5m])) * 100)</span><br></span></code></pre></div></div>
<p><strong>CPU 모드별 사용률:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># User mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (instance) (rate(node_cpu_seconds_total{mode=&quot;user&quot;}[5m])) * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># System mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (instance) (rate(node_cpu_seconds_total{mode=&quot;system&quot;}[5m])) * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># I/O wait</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (instance) (rate(node_cpu_seconds_total{mode=&quot;iowait&quot;}[5m])) * 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="메모리-사용률">메모리 사용률<a href="#메모리-사용률" class="hash-link" aria-label="메모리 사용률에 대한 직접 링크" title="메모리 사용률에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>메모리 사용률:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_MemTotal_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<p><strong>사용 가능한 메모리:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_MemAvailable_bytes / 1024 / 1024 / 1024  # GB 단위</span><br></span></code></pre></div></div>
<p><strong>메모리 상세 분석:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 버퍼 메모리</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_Buffers_bytes / 1024 / 1024  # MB 단위</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 캐시 메모리</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_Cached_bytes / 1024 / 1024</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 스왑 사용률</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_memory_SwapTotal_bytes - node_memory_SwapFree_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_SwapTotal_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="디스크-사용률">디스크 사용률<a href="#디스크-사용률" class="hash-link" aria-label="디스크 사용률에 대한 직접 링크" title="디스크 사용률에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>디스크 사용률:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_filesystem_size_bytes - node_filesystem_avail_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_filesystem_size_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<p><strong>파일시스템별 사용률:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_filesystem_size_bytes{mountpoint=&quot;/&quot;} -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_filesystem_avail_bytes{mountpoint=&quot;/&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_filesystem_size_bytes{mountpoint=&quot;/&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<p><strong>디스크 사용량 증가율:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1시간 동안 증가한 디스크 사용량</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delta(node_filesystem_avail_bytes[1h])</span><br></span></code></pre></div></div>
<p><strong>디스크 고갈 예측:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 추세로 24시간 후 사용 가능한 공간</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">predict_linear(node_filesystem_avail_bytes[6h], 24 * 3600)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="네트워크-트래픽">네트워크 트래픽<a href="#네트워크-트래픽" class="hash-link" aria-label="네트워크 트래픽에 대한 직접 링크" title="네트워크 트래픽에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>수신 트래픽:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 초당 수신 바이트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(node_network_receive_bytes_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 초당 수신 메가바이트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(node_network_receive_bytes_total[5m]) / 1024 / 1024</span><br></span></code></pre></div></div>
<p><strong>송신 트래픽:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 초당 송신 바이트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(node_network_transmit_bytes_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 초당 송신 메가바이트</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(node_network_transmit_bytes_total[5m]) / 1024 / 1024</span><br></span></code></pre></div></div>
<p><strong>총 트래픽:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rate(node_network_receive_bytes_total[5m]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rate(node_network_transmit_bytes_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) / 1024 / 1024  # MB/s</span><br></span></code></pre></div></div>
<p><strong>인터페이스별 트래픽:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (device) (rate(node_network_receive_bytes_total[5m]))</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="38-복잡한-쿼리-예제">3.8 복잡한 쿼리 예제<a href="#38-복잡한-쿼리-예제" class="hash-link" aria-label="3.8 복잡한 쿼리 예제에 대한 직접 링크" title="3.8 복잡한 쿼리 예제에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="slislo-계산">SLI/SLO 계산<a href="#slislo-계산" class="hash-link" aria-label="SLI/SLO 계산에 대한 직접 링크" title="SLI/SLO 계산에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>Availability SLI:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 30일 가용성</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status!~&quot;5..&quot;}[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 99.9% SLO 달성 여부</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total{status!~&quot;5..&quot;}[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) &gt;= 0.999</span><br></span></code></pre></div></div>
<p><strong>Latency SLI:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># P99 레이턴시가 1초 미만인 요청의 비율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_bucket{le=&quot;1&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_count[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 95% SLO 달성 여부</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_bucket{le=&quot;1&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_count[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) &gt;= 0.95</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-budget-계산">Error Budget 계산<a href="#error-budget-계산" class="hash-link" aria-label="Error Budget 계산에 대한 직접 링크" title="Error Budget 계산에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 30일 Error Budget (99.9% SLO 기준)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Error Budget = 1 - SLO = 0.1%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 - 0.999) -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total{status=~&quot;5..&quot;}[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Error Budget 소진율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total{status=~&quot;5..&quot;}[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[30d]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 - 0.999)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="apdex-score-계산">Apdex Score 계산<a href="#apdex-score-계산" class="hash-link" aria-label="Apdex Score 계산에 대한 직접 링크" title="Apdex Score 계산에 대한 직접 링크" translate="no">​</a></h3>
<p>Apdex는 사용자 만족도를 측정하는 표준 메트릭입니다.</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Apdex Score</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Satisfied: 응답시간 &lt; 0.5s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Tolerating: 0.5s &lt;= 응답시간 &lt; 2s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Frustrated: 응답시간 &gt;= 2s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_bucket{le=&quot;0.5&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_bucket{le=&quot;2&quot;}[5m])) / 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_count[5m]))</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="금주와-전주-비교">금주와 전주 비교<a href="#금주와-전주-비교" class="hash-link" aria-label="금주와 전주 비교에 대한 직접 링크" title="금주와 전주 비교에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 이번 주 트래픽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[1w]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난 주 트래픽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[1w] offset 1w))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 증가율 계산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[1w]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[1w] offset 1w))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[1w] offset 1w))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="이상-탐지-anomaly-detection">이상 탐지 (Anomaly Detection)<a href="#이상-탐지-anomaly-detection" class="hash-link" aria-label="이상 탐지 (Anomaly Detection)에 대한 직접 링크" title="이상 탐지 (Anomaly Detection)에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>표준편차 기반:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 현재 값이 평균 + 2*표준편차를 초과하는지 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">abs(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  http_requests_total -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  avg_over_time(http_requests_total[1h])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2 * stddev_over_time(http_requests_total[1h])</span><br></span></code></pre></div></div>
<p><strong>이전 주 동일 시간대 대비:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 지난주 같은 시간대보다 50% 이상 증가</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rate(http_requests_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rate(http_requests_total[5m] offset 1w)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m] offset 1w)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; 0.5</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="복합-알림-조건">복합 알림 조건<a href="#복합-알림-조건" class="hash-link" aria-label="복합 알림 조건에 대한 직접 링크" title="복합 알림 조건에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 높은 에러율 AND 높은 트래픽</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &gt; 0.05</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m])) &gt; 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 높은 레이턴시 OR 높은 에러율</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  histogram_quantile(0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum by (le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ) &gt; 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &gt; 0.05</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="카디널리티-분석">카디널리티 분석<a href="#카디널리티-분석" class="hash-link" aria-label="카디널리티 분석에 대한 직접 링크" title="카디널리티 분석에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메트릭 이름별 시계열 개수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count by (__name__) ({__name__=~&quot;.+&quot;})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 메트릭의 레이블별 고유 값 개수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count by (label_name) (metric_name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 가장 높은 카디널리티를 가진 메트릭 상위 10개</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topk(10, count by (__name__) ({__name__=~&quot;.+&quot;}))</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="39-python으로-promql-쿼리-실행">3.9 Python으로 PromQL 쿼리 실행<a href="#39-python으로-promql-쿼리-실행" class="hash-link" aria-label="3.9 Python으로 PromQL 쿼리 실행에 대한 직접 링크" title="3.9 Python으로 PromQL 쿼리 실행에 대한 직접 링크" translate="no">​</a></h2>
<p>Prometheus HTTP API를 사용하여 Python에서 PromQL 쿼리를 실행할 수 있습니다.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="기본-쿼리-실행">기본 쿼리 실행<a href="#기본-쿼리-실행" class="hash-link" aria-label="기본 쿼리 실행에 대한 직접 링크" title="기본 쿼리 실행에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">PrometheusClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_url</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_url </span><span class="token operator">=</span><span class="token plain"> base_url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query_range&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;Instant query 실행&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">query_range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> step</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;15s&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;Range query 실행&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;start&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;end&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;step&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 사용 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client </span><span class="token operator">=</span><span class="token plain"> PrometheusClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Instant query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;up&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Range query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rate(http_requests_total[5m])&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-01-01T00:00:00Z&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2024-01-01T01:00:00Z&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    step</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="실전-활용-예제">실전 활용 예제<a href="#실전-활용-예제" class="hash-link" aria-label="실전 활용 예제에 대한 직접 링크" title="실전 활용 예제에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">PrometheusAnalyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_url</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_url </span><span class="token operator">=</span><span class="token plain"> base_url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query_range&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_current_metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;현재 메트릭 값 조회&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;success&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Query failed: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            metric </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;metric&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token operator">**</span><span class="token plain">metric</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_time_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> step</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1m&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;시계열 데이터 조회&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        end </span><span class="token operator">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        start </span><span class="token operator">=</span><span class="token plain"> end </span><span class="token operator">-</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hours</span><span class="token operator">=</span><span class="token plain">hours</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;start&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Z&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;end&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Z&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;step&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;success&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Query failed: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        all_series </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            metric </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;metric&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            values </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;values&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            df </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">values</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> columns</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> unit</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> val </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> metric</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> val</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            all_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> all_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">all_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ignore_index</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calculate_error_rate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;에러율 계산&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        promql </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        sum(rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;, status=~&quot;5..&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        sum(rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        &#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_time_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token plain">hours</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calculate_latency_percentiles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> percentiles</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.95</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.99</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;레이턴시 percentile 계산&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> p </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> percentiles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            promql </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            histogram_quantile(</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">p</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">              sum by (le) (rate(http_request_duration_seconds_bucket{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            &#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            df </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_current_metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">empty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;p</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">int</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">p</span><span class="token string-interpolation interpolation operator">*</span><span class="token string-interpolation interpolation number">100</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_top_endpoints_by_traffic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> limit</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;트래픽이 높은 엔드포인트 조회&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        promql </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        topk(</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">limit</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">          sum by (endpoint) (rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        &#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_current_metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">plot_time_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> title</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Time Series&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;시계열 데이터 시각화&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        df </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_time_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token plain">hours</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">empty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;No data to plot&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">figsize</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># 레이블 조합으로 그룹화</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instance&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> instance </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instance&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data </span><span class="token operator">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instance&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token plain">instance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Time&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">xticks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rotation</span><span class="token operator">=</span><span class="token number">45</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tight_layout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 사용 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">analyzer </span><span class="token operator">=</span><span class="token plain"> PrometheusAnalyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 현재 에러율 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">error_rate </span><span class="token operator">=</span><span class="token plain"> analyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">calculate_error_rate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hours</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Error Rate:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error_rate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 레이턴시 percentile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">latency </span><span class="token operator">=</span><span class="token plain"> analyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">calculate_latency_percentiles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\nLatency Percentiles:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">latency</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 상위 엔드포인트</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">top_endpoints </span><span class="token operator">=</span><span class="token plain"> analyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_top_endpoints_by_traffic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> limit</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\nTop Endpoints:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">top_endpoints</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># CPU 사용률 시각화</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">analyzer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plot_time_series</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rate(node_cpu_seconds_total{mode!=&quot;idle&quot;}[5m]) * 100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    hours</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;CPU Usage&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="대시보드-데이터-수집">대시보드 데이터 수집<a href="#대시보드-데이터-수집" class="hash-link" aria-label="대시보드 데이터 수집에 대한 직접 링크" title="대시보드 데이터 수집에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">PrometheusDashboard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_url</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_url </span><span class="token operator">=</span><span class="token plain"> base_url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_dashboard_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> job</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;대시보드용 종합 데이터 수집&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queries </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;total_requests&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;sum(rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;error_rate&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                sum(rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;, status=~&quot;5..&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                sum(rate(http_requests_total{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            &#x27;&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;p95_latency&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                histogram_quantile(0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                  sum by (le) (rate(http_request_duration_seconds_bucket{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            &#x27;&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;p99_latency&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                histogram_quantile(0.99,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                  sum by (le) (rate(http_request_duration_seconds_bucket{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            &#x27;&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;active_instances&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;count(up{{job=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;}} == 1)&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cpu_usage&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;avg(rate(node_cpu_seconds_total{{mode!=&quot;idle&quot;}}[5m])) * 100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memory_usage&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                avg(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                  (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                  /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                  node_memory_MemTotal_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">                ) * 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">            &#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> queries</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;success&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">round</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Error fetching </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">print_dashboard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> job</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;대시보드 출력&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_dashboard_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;=&quot;</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Dashboard for </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">job</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">center</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;=&quot;</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;\nTraffic:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Total Requests/s: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;total_requests&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;\nReliability:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Error Rate: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;error_rate&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">%&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Active Instances: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;active_instances&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;\nLatency:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  P95: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;p95_latency&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  P99: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;p99_latency&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;\nInfrastructure:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  CPU Usage: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;cpu_usage&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">%&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Memory Usage: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;memory_usage&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">%&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;=&quot;</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 사용 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dashboard </span><span class="token operator">=</span><span class="token plain"> PrometheusDashboard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dashboard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">print_dashboard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;api-server&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="알림-조건-검증">알림 조건 검증<a href="#알림-조건-검증" class="hash-link" aria-label="알림 조건 검증에 대한 직접 링크" title="알림 조건 검증에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">PrometheusAlertValidator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_url</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">base_url </span><span class="token operator">=</span><span class="token plain"> base_url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_range_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">base_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query_range&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">check_alert_condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> comparison</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;알림 조건 확인&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> promql</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;success&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        comparisons </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v </span><span class="token operator">&gt;</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gte&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v </span><span class="token operator">&gt;=</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;lt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v </span><span class="token operator">&lt;</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;lte&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v </span><span class="token operator">&lt;=</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;eq&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> v </span><span class="token operator">==</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        is_triggered </span><span class="token operator">=</span><span class="token plain"> comparisons</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">comparison</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> is_triggered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">validate_alert_rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> alerts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;여러 알림 규칙 검증&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> alert </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> alerts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            is_triggered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_alert_condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;comparison&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;triggered&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> is_triggered</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;current_value&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;warning&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">print_alert_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> alerts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;알림 상태 출력&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        results </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">validate_alert_rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">alerts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\nAlert Status:&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;=&quot;</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            status </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;FIRING&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;triggered&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;OK&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            severity </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;[</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">status</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">] [</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">severity</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">] </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Current: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;current_value&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;  Threshold: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 사용 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">validator </span><span class="token operator">=</span><span class="token plain"> PrometheusAlertValidator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">alert_rules </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;High Error Rate&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m])) / sum(rate(http_requests_total[5m])) * 100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;comparison&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;critical&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;High Latency P95&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;histogram_quantile(0.95, sum by (le) (rate(http_request_duration_seconds_bucket[5m])))&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;comparison&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;warning&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Low CPU Usage&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;avg(rate(node_cpu_seconds_total{mode!=&quot;idle&quot;}[5m])) * 100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;threshold&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;comparison&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;lt&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;info&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">validator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">print_alert_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">alert_rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="310-쿼리-최적화">3.10 쿼리 최적화<a href="#310-쿼리-최적화" class="hash-link" aria-label="3.10 쿼리 최적화에 대한 직접 링크" title="3.10 쿼리 최적화에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="최적화-원칙">최적화 원칙<a href="#최적화-원칙" class="hash-link" aria-label="최적화 원칙에 대한 직접 링크" title="최적화 원칙에 대한 직접 링크" translate="no">​</a></h3>
<ol>
<li class=""><strong>Recording Rules 활용</strong>: 자주 사용하는 복잡한 쿼리는 recording rule로 사전 계산</li>
<li class=""><strong>레이블 카디널리티 최소화</strong>: 불필요한 레이블 제거</li>
<li class=""><strong>적절한 시간 범위 선택</strong>: 너무 긴 범위는 성능 저하</li>
<li class=""><strong>집계 우선</strong>: 가능한 한 일찍 집계 수행</li>
<li class=""><strong>정규식 최소화</strong>: 정확한 매칭 우선 사용</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="나쁜-쿼리-vs-좋은-쿼리">나쁜 쿼리 vs 좋은 쿼리<a href="#나쁜-쿼리-vs-좋은-쿼리" class="hash-link" aria-label="나쁜 쿼리 vs 좋은 쿼리에 대한 직접 링크" title="나쁜 쿼리 vs 좋은 쿼리에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>나쁜 예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 정규식 남용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{__name__=~&quot;.*requests.*&quot;, instance=~&quot;.*prod.*&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 너무 긴 시간 범위</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[1d])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 늦은 집계</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(http_requests_total{status=&quot;200&quot;} + http_requests_total{status=&quot;201&quot;})</span><br></span></code></pre></div></div>
<p><strong>좋은 예시:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 정확한 메트릭 이름 사용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{instance=~&quot;prod.*&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 적절한 시간 범위 (4x scrape interval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 조기 집계</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(http_requests_total{status=~&quot;20.&quot;})</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="카디널리티-관리">카디널리티 관리<a href="#카디널리티-관리" class="hash-link" aria-label="카디널리티 관리에 대한 직접 링크" title="카디널리티 관리에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>높은 카디널리티 확인:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메트릭별 시계열 개수</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topk(20, count by (__name__) ({__name__=~&quot;.+&quot;}))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 메트릭의 레이블 카디널리티</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count by (label_name) (metric_name)</span><br></span></code></pre></div></div>
<p><strong>해결 방법:</strong></p>
<ol>
<li class="">Recording rules로 집계된 메트릭 생성</li>
<li class="">불필요한 레이블 제거 (relabel_configs 사용)</li>
<li class="">레이블 값 정규화</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="쿼리-성능-측정">쿼리 성능 측정<a href="#쿼리-성능-측정" class="hash-link" aria-label="쿼리 성능 측정에 대한 직접 링크" title="쿼리 성능 측정에 대한 직접 링크" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">measure_query_performance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prometheus_url</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;쿼리 성능 측정&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_time </span><span class="token operator">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">prometheus_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/v1/query&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;query&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end_time </span><span class="token operator">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    execution_time </span><span class="token operator">=</span><span class="token plain"> end_time </span><span class="token operator">-</span><span class="token plain"> start_time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result_count </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;data&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;result&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Query: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Execution Time: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">execution_time</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token string-interpolation interpolation format-spec">.3f</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f&quot;Result Count: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result_count</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> execution_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> result_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">measure_query_performance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;up&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">measure_query_performance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rate(http_requests_total[5m])&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">measure_query_performance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;sum by (job) (rate(http_requests_total[5m]))&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="311-디버깅-팁">3.11 디버깅 팁<a href="#311-디버깅-팁" class="hash-link" aria-label="3.11 디버깅 팁에 대한 직접 링크" title="3.11 디버깅 팁에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="쿼리-단계별-실행">쿼리 단계별 실행<a href="#쿼리-단계별-실행" class="hash-link" aria-label="쿼리 단계별 실행에 대한 직접 링크" title="쿼리 단계별 실행에 대한 직접 링크" translate="no">​</a></h3>
<p>복잡한 쿼리는 단계별로 나누어 실행하세요:</p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1단계: 기본 메트릭 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 2단계: 필터 추가</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{status=~&quot;5..&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 3단계: Rate 계산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total{status=~&quot;5..&quot;}[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 4단계: 집계</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 5단계: 에러율 계산</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="일반적인-오류와-해결">일반적인 오류와 해결<a href="#일반적인-오류와-해결" class="hash-link" aria-label="일반적인 오류와 해결에 대한 직접 링크" title="일반적인 오류와 해결에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>오류 1: &quot;no data&quot;</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 문제: 메트릭이 존재하지 않음</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">non_existent_metric</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 해결: 메트릭 이름 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{__name__=~&quot;.*request.*&quot;}  # 메트릭 검색</span><br></span></code></pre></div></div>
<p><strong>오류 2: &quot;invalid expression type&quot;</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 문제: range vector를 instant vector처럼 사용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total[5m] &gt; 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 해결: rate() 등의 함수 사용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rate(http_requests_total[5m]) &gt; 100</span><br></span></code></pre></div></div>
<p><strong>오류 3: &quot;many-to-many matching not allowed&quot;</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 문제: 레이블 매칭 실패</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metric1 / metric2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 해결: on() 또는 ignoring() 사용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">metric1 / on(job) metric2</span><br></span></code></pre></div></div>
<p><strong>오류 4: 빈 결과</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 문제: 레이블 선택자가 너무 엄격</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{job=&quot;api&quot;, instance=&quot;localhost:8080&quot;, method=&quot;GET&quot;, endpoint=&quot;/api&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 해결: 필수 레이블만 사용</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http_requests_total{job=&quot;api&quot;}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="유용한-디버깅-쿼리">유용한 디버깅 쿼리<a href="#유용한-디버깅-쿼리" class="hash-link" aria-label="유용한 디버깅 쿼리에 대한 직접 링크" title="유용한 디버깅 쿼리에 대한 직접 링크" translate="no">​</a></h3>
<p><strong>메트릭 탐색:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 모든 메트릭 이름</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{__name__=~&quot;.+&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 문자열 포함 메트릭</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{__name__=~&quot;.*http.*&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 job의 모든 메트릭</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{job=&quot;api-server&quot;}</span><br></span></code></pre></div></div>
<p><strong>레이블 확인:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 특정 메트릭의 모든 레이블 조합</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count by (label1, label2) (metric_name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 레이블 값 목록</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group by (label_name) (metric_name)</span><br></span></code></pre></div></div>
<p><strong>데이터 존재 확인:</strong></p>
<div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 최근 5분간 데이터가 있는지 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">count_over_time(metric_name[5m])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 메트릭이 수집되고 있는지 확인</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">up{job=&quot;target-job&quot;}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prometheus-ui-활용">Prometheus UI 활용<a href="#prometheus-ui-활용" class="hash-link" aria-label="Prometheus UI 활용에 대한 직접 링크" title="Prometheus UI 활용에 대한 직접 링크" translate="no">​</a></h3>
<ol>
<li class=""><strong>Graph 탭</strong>: 시계열 데이터 시각화</li>
<li class=""><strong>Table 탭</strong>: 현재 값 테이블로 표시</li>
<li class=""><strong>Console 탭</strong>: 상세 결과 확인</li>
<li class=""><strong>Enable query history</strong>: 이전 쿼리 재사용</li>
<li class=""><strong>Enable autocomplete</strong>: 메트릭 이름 자동완성</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="312-연습-문제">3.12 연습 문제<a href="#312-연습-문제" class="hash-link" aria-label="3.12 연습 문제에 대한 직접 링크" title="3.12 연습 문제에 대한 직접 링크" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="기초-문제">기초 문제<a href="#기초-문제" class="hash-link" aria-label="기초 문제에 대한 직접 링크" title="기초 문제에 대한 직접 링크" translate="no">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>1. 모든 인스턴스의 총 HTTP 요청 수를 계산하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(http_requests_total)</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>2. GET 메서드만 필터링하여 초당 요청 수를 계산하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total{method=&quot;GET&quot;}[5m]))</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>3. CPU 사용률이 80% 이상인 인스턴스를 찾으세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_cpu_usage &gt; 80</span><br></span></code></pre></div></div></div></div></details>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="중급-문제">중급 문제<a href="#중급-문제" class="hash-link" aria-label="중급 문제에 대한 직접 링크" title="중급 문제에 대한 직접 링크" translate="no">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>4. 서비스별 에러율을 계산하세요 (5xx 응답 기준).</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total{status=~&quot;5..&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (service) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>5. 엔드포인트별 95th percentile 레이턴시를 계산하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">histogram_quantile(0.95,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum by (endpoint, le) (rate(http_request_duration_seconds_bucket[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>6. 메모리 사용률을 퍼센트로 계산하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">node_memory_MemTotal_bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div></div></div></details>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="고급-문제">고급 문제<a href="#고급-문제" class="hash-link" aria-label="고급 문제에 대한 직접 링크" title="고급 문제에 대한 직접 링크" translate="no">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>7. 현재 트래픽과 1시간 전 트래픽을 비교하여 증가율을 계산하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_requests_total[5m] offset 1h))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m] offset 1h))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>8. Apdex Score를 계산하세요 (Satisfied: &lt; 0.3s, Tolerating: &lt; 1.2s).</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_bucket{le=&quot;0.3&quot;}[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sum(rate(http_request_duration_seconds_bucket{le=&quot;1.2&quot;}[5m])) / 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_request_duration_seconds_count[5m]))</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>9. 현재 추세로 6시간 후 디스크가 가득 찰 것으로 예측되는 인스턴스를 찾으세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">predict_linear(node_filesystem_avail_bytes[1h], 6 * 3600) &lt; 0</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>10. 메서드와 상태코드별 요청 분포를 계산하고, 전체 대비 비율을 구하세요.</summary><div><div class="collapsibleContent_i85q"><div class="language-promql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-promql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum by (method, status) (rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sum(rate(http_requests_total[5m]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* 100</span><br></span></code></pre></div></div></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="다음-단계">다음 단계<a href="#다음-단계" class="hash-link" aria-label="다음 단계에 대한 직접 링크" title="다음 단계에 대한 직접 링크" translate="no">​</a></h2>
<p>이제 PromQL의 기본부터 고급 활용까지 모두 다뤘습니다. 다음 섹션에서는 Grafana와 Prometheus를 연동하여 강력한 시각화 대시보드를 만드는 방법을 배웁니다.</p>
<p><a class="" href="/docs/prometheus/grafana">Grafana 연동</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/prometheus/promql.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="문서 페이지"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/prometheus/metrics"><div class="pagination-nav__sublabel">이전</div><div class="pagination-nav__label">2. 메트릭과 Python 클라이언트</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/prometheus/grafana"><div class="pagination-nav__sublabel">다음</div><div class="pagination-nav__label">4. Grafana 연동</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#31-promql-기본-개념" class="table-of-contents__link toc-highlight">3.1 PromQL 기본 개념</a><ul><li><a href="#시계열-데이터-이해" class="table-of-contents__link toc-highlight">시계열 데이터 이해</a></li><li><a href="#데이터-타입" class="table-of-contents__link toc-highlight">데이터 타입</a></li></ul></li><li><a href="#32-selectors-선택자" class="table-of-contents__link toc-highlight">3.2 Selectors (선택자)</a><ul><li><a href="#instant-vector-selectors" class="table-of-contents__link toc-highlight">Instant Vector Selectors</a></li><li><a href="#range-vector-selectors" class="table-of-contents__link toc-highlight">Range Vector Selectors</a></li><li><a href="#offset-modifier" class="table-of-contents__link toc-highlight">Offset Modifier</a></li></ul></li><li><a href="#33-operators-연산자" class="table-of-contents__link toc-highlight">3.3 Operators (연산자)</a><ul><li><a href="#arithmetic-operators-산술-연산자" class="table-of-contents__link toc-highlight">Arithmetic Operators (산술 연산자)</a></li><li><a href="#comparison-operators-비교-연산자" class="table-of-contents__link toc-highlight">Comparison Operators (비교 연산자)</a></li><li><a href="#logical-operators-논리-연산자" class="table-of-contents__link toc-highlight">Logical Operators (논리 연산자)</a></li><li><a href="#vector-matching" class="table-of-contents__link toc-highlight">Vector Matching</a></li></ul></li><li><a href="#34-functions-함수" class="table-of-contents__link toc-highlight">3.4 Functions (함수)</a><ul><li><a href="#rate-functions" class="table-of-contents__link toc-highlight">Rate Functions</a></li><li><a href="#aggregation-functions" class="table-of-contents__link toc-highlight">Aggregation Functions</a></li><li><a href="#time-functions" class="table-of-contents__link toc-highlight">Time Functions</a></li><li><a href="#mathematical-functions" class="table-of-contents__link toc-highlight">Mathematical Functions</a></li><li><a href="#delta-and-derivative-functions" class="table-of-contents__link toc-highlight">Delta and Derivative Functions</a></li><li><a href="#prediction-functions" class="table-of-contents__link toc-highlight">Prediction Functions</a></li><li><a href="#label-manipulation-functions" class="table-of-contents__link toc-highlight">Label Manipulation Functions</a></li><li><a href="#sorting-functions" class="table-of-contents__link toc-highlight">Sorting Functions</a></li><li><a href="#histogram-functions" class="table-of-contents__link toc-highlight">Histogram Functions</a></li><li><a href="#other-useful-functions" class="table-of-contents__link toc-highlight">Other Useful Functions</a></li></ul></li><li><a href="#35-aggregation-operations" class="table-of-contents__link toc-highlight">3.5 Aggregation Operations</a><ul><li><a href="#by와-without" class="table-of-contents__link toc-highlight">by와 without</a></li><li><a href="#실전-집계-패턴" class="table-of-contents__link toc-highlight">실전 집계 패턴</a></li></ul></li><li><a href="#36-recording-rules" class="table-of-contents__link toc-highlight">3.6 Recording Rules</a><ul><li><a href="#설정-방법" class="table-of-contents__link toc-highlight">설정 방법</a></li><li><a href="#recording-rule-작성" class="table-of-contents__link toc-highlight">Recording Rule 작성</a></li><li><a href="#naming-convention" class="table-of-contents__link toc-highlight">Naming Convention</a></li></ul></li><li><a href="#37-실전-쿼리-패턴" class="table-of-contents__link toc-highlight">3.7 실전 쿼리 패턴</a><ul><li><a href="#에러율-error-rate" class="table-of-contents__link toc-highlight">에러율 (Error Rate)</a></li><li><a href="#레이턴시-latency" class="table-of-contents__link toc-highlight">레이턴시 (Latency)</a></li><li><a href="#처리량-throughput" class="table-of-contents__link toc-highlight">처리량 (Throughput)</a></li><li><a href="#cpu-사용률" class="table-of-contents__link toc-highlight">CPU 사용률</a></li><li><a href="#메모리-사용률" class="table-of-contents__link toc-highlight">메모리 사용률</a></li><li><a href="#디스크-사용률" class="table-of-contents__link toc-highlight">디스크 사용률</a></li><li><a href="#네트워크-트래픽" class="table-of-contents__link toc-highlight">네트워크 트래픽</a></li></ul></li><li><a href="#38-복잡한-쿼리-예제" class="table-of-contents__link toc-highlight">3.8 복잡한 쿼리 예제</a><ul><li><a href="#slislo-계산" class="table-of-contents__link toc-highlight">SLI/SLO 계산</a></li><li><a href="#error-budget-계산" class="table-of-contents__link toc-highlight">Error Budget 계산</a></li><li><a href="#apdex-score-계산" class="table-of-contents__link toc-highlight">Apdex Score 계산</a></li><li><a href="#금주와-전주-비교" class="table-of-contents__link toc-highlight">금주와 전주 비교</a></li><li><a href="#이상-탐지-anomaly-detection" class="table-of-contents__link toc-highlight">이상 탐지 (Anomaly Detection)</a></li><li><a href="#복합-알림-조건" class="table-of-contents__link toc-highlight">복합 알림 조건</a></li><li><a href="#카디널리티-분석" class="table-of-contents__link toc-highlight">카디널리티 분석</a></li></ul></li><li><a href="#39-python으로-promql-쿼리-실행" class="table-of-contents__link toc-highlight">3.9 Python으로 PromQL 쿼리 실행</a><ul><li><a href="#기본-쿼리-실행" class="table-of-contents__link toc-highlight">기본 쿼리 실행</a></li><li><a href="#실전-활용-예제" class="table-of-contents__link toc-highlight">실전 활용 예제</a></li><li><a href="#대시보드-데이터-수집" class="table-of-contents__link toc-highlight">대시보드 데이터 수집</a></li><li><a href="#알림-조건-검증" class="table-of-contents__link toc-highlight">알림 조건 검증</a></li></ul></li><li><a href="#310-쿼리-최적화" class="table-of-contents__link toc-highlight">3.10 쿼리 최적화</a><ul><li><a href="#최적화-원칙" class="table-of-contents__link toc-highlight">최적화 원칙</a></li><li><a href="#나쁜-쿼리-vs-좋은-쿼리" class="table-of-contents__link toc-highlight">나쁜 쿼리 vs 좋은 쿼리</a></li><li><a href="#카디널리티-관리" class="table-of-contents__link toc-highlight">카디널리티 관리</a></li><li><a href="#쿼리-성능-측정" class="table-of-contents__link toc-highlight">쿼리 성능 측정</a></li></ul></li><li><a href="#311-디버깅-팁" class="table-of-contents__link toc-highlight">3.11 디버깅 팁</a><ul><li><a href="#쿼리-단계별-실행" class="table-of-contents__link toc-highlight">쿼리 단계별 실행</a></li><li><a href="#일반적인-오류와-해결" class="table-of-contents__link toc-highlight">일반적인 오류와 해결</a></li><li><a href="#유용한-디버깅-쿼리" class="table-of-contents__link toc-highlight">유용한 디버깅 쿼리</a></li><li><a href="#prometheus-ui-활용" class="table-of-contents__link toc-highlight">Prometheus UI 활용</a></li></ul></li><li><a href="#312-연습-문제" class="table-of-contents__link toc-highlight">3.12 연습 문제</a><ul><li><a href="#기초-문제" class="table-of-contents__link toc-highlight">기초 문제</a></li><li><a href="#중급-문제" class="table-of-contents__link toc-highlight">중급 문제</a></li><li><a href="#고급-문제" class="table-of-contents__link toc-highlight">고급 문제</a></li></ul></li><li><a href="#다음-단계" class="table-of-contents__link toc-highlight">다음 단계</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">학습 가이드</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/github/intro">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/writing/intro">Writing</a></li><li class="footer__item"><a class="footer__link-item" href="/python/intro">Python</a></li><li class="footer__item"><a class="footer__link-item" href="/prometheus/intro">Prometheus</a></li><li class="footer__item"><a class="footer__link-item" href="/n8n/intro">n8n</a></li><li class="footer__item"><a class="footer__link-item" href="/pandas/intro">pandas</a></li><li class="footer__item"><a class="footer__link-item" href="/webapp/intro">Web App</a></li><li class="footer__item"><a class="footer__link-item" href="/dagster/intro">Dagster</a></li><li class="footer__item"><a class="footer__link-item" href="/apscheduler/intro">APScheduler</a></li><li class="footer__item"><a class="footer__link-item" href="/enterprise/intro">Enterprise App</a></li><li class="footer__item"><a class="footer__link-item" href="/webdev/intro">Web Dev</a></li><li class="footer__item"><a class="footer__link-item" href="/devops/intro">DevOps</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">리소스</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://git-scm.com/doc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Git 공식 문서<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">더 보기</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus</div></div></div></footer></div>
</body>
</html>