"use strict";(globalThis.webpackChunkgithub_docs=globalThis.webpackChunkgithub_docs||[]).push([[6713],{4821:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"rabbitmq/intermediate/rpc","title":"RPC (Remote Procedure Call)","description":"RabbitMQ\ub85c \uc694\uccad/\uc751\ub2f5 \ud328\ud134\uc744 \uad6c\ud604\ud574\ubd05\uc2dc\ub2e4!","source":"@site/docs/rabbitmq/intermediate/rpc.md","sourceDirName":"rabbitmq/intermediate","slug":"/rabbitmq/intermediate/rpc","permalink":"/docs/rabbitmq/intermediate/rpc","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rabbitmq/intermediate/rpc.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"rabbitmqSidebar","previous":{"title":"\uc911\uae09\ud3b8 \uc18c\uac1c","permalink":"/docs/rabbitmq/intermediate/intro"},"next":{"title":"Dead Letter Exchange (DLX)","permalink":"/docs/rabbitmq/intermediate/dead-letter-exchange"}}');var c=r(4848),l=r(8453);const s={sidebar_position:2},t="RPC (Remote Procedure Call)",o={},a=[{value:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c",id:"-\ud559\uc2b5-\ubaa9\ud45c",level:2},{value:"\ud83d\udcca \ud328\ud134 \uad6c\uc870",id:"-\ud328\ud134-\uad6c\uc870",level:2},{value:"\ud83d\udcdd \uad6c\ud604",id:"-\uad6c\ud604",level:2},{value:"RPC Server",id:"rpc-server",level:3},{value:"RPC Client",id:"rpc-client",level:3},{value:"\ud14c\uc2a4\ud2b8 \ucf54\ub4dc",id:"\ud14c\uc2a4\ud2b8-\ucf54\ub4dc",level:3},{value:"\ud83d\udca1 \ud575\uc2ec \uac1c\ub150",id:"-\ud575\uc2ec-\uac1c\ub150",level:2},{value:"Correlation ID",id:"correlation-id",level:3},{value:"Reply Queue",id:"reply-queue",level:3},{value:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4",id:"-\ub2e4\uc74c-\ub2e8\uacc4",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"rpc-remote-procedure-call",children:"RPC (Remote Procedure Call)"})}),"\n",(0,c.jsx)(n.p,{children:"RabbitMQ\ub85c \uc694\uccad/\uc751\ub2f5 \ud328\ud134\uc744 \uad6c\ud604\ud574\ubd05\uc2dc\ub2e4!"}),"\n",(0,c.jsx)(n.h2,{id:"-\ud559\uc2b5-\ubaa9\ud45c",children:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"RPC \ud328\ud134 \uc774\ud574"}),"\n",(0,c.jsx)(n.li,{children:"Correlation ID \uc0ac\uc6a9"}),"\n",(0,c.jsx)(n.li,{children:"Reply Queue \uad6c\ud604"}),"\n",(0,c.jsx)(n.li,{children:"\ud0c0\uc784\uc544\uc6c3 \ucc98\ub9ac"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"-\ud328\ud134-\uad6c\uc870",children:"\ud83d\udcca \ud328\ud134 \uad6c\uc870"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Client                     Server\n  |                          |\n  |---(request + reply_to)--\x3e|\n  |                          |\n  |<--(response)-------------|\n"})}),"\n",(0,c.jsx)(n.h2,{id:"-\uad6c\ud604",children:"\ud83d\udcdd \uad6c\ud604"}),"\n",(0,c.jsx)(n.h3,{id:"rpc-server",children:"RPC Server"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# rpc_server.py\nimport pika\nimport json\n\ndef fibonacci(n):\n    """\ud53c\ubcf4\ub098\uce58 \uacc4\uc0b0"""\n    if n <= 1:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)\n\ndef on_request(ch, method, props, body):\n    """RPC \uc694\uccad \ucc98\ub9ac"""\n    data = json.loads(body.decode())\n    n = data[\'n\']\n\n    print(f" [.] fib({n})")\n    response = fibonacci(n)\n\n    # \uc751\ub2f5 \ubc1c\ud589\n    ch.basic_publish(\n        exchange=\'\',\n        routing_key=props.reply_to,\n        properties=pika.BasicProperties(\n            correlation_id=props.correlation_id\n        ),\n        body=json.dumps({\'result\': response})\n    )\n\n    ch.basic_ack(delivery_tag=method.delivery_tag)\n\nconnection = pika.BlockingConnection(\n    pika.ConnectionParameters(\'localhost\')\n)\nchannel = connection.channel()\nchannel.queue_declare(queue=\'rpc_queue\')\nchannel.basic_qos(prefetch_count=1)\nchannel.basic_consume(\n    queue=\'rpc_queue\',\n    on_message_callback=on_request\n)\n\nprint(" [x] Awaiting RPC requests")\nchannel.start_consuming()\n'})}),"\n",(0,c.jsx)(n.h3,{id:"rpc-client",children:"RPC Client"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# rpc_client.py\nimport pika\nimport uuid\nimport json\n\nclass FibonacciRpcClient:\n    """RPC \ud074\ub77c\uc774\uc5b8\ud2b8"""\n\n    def __init__(self):\n        self.connection = pika.BlockingConnection(\n            pika.ConnectionParameters(\'localhost\')\n        )\n        self.channel = self.connection.channel()\n\n        # Reply queue \uc0dd\uc131\n        result = self.channel.queue_declare(queue=\'\', exclusive=True)\n        self.callback_queue = result.method.queue\n\n        self.channel.basic_consume(\n            queue=self.callback_queue,\n            on_message_callback=self.on_response,\n            auto_ack=True\n        )\n\n        self.response = None\n        self.corr_id = None\n\n    def on_response(self, ch, method, props, body):\n        """\uc751\ub2f5 \uc218\uc2e0"""\n        if self.corr_id == props.correlation_id:\n            self.response = json.loads(body.decode())\n\n    def call(self, n):\n        """RPC \ud638\ucd9c"""\n        self.response = None\n        self.corr_id = str(uuid.uuid4())\n\n        # \uc694\uccad \ubc1c\ud589\n        self.channel.basic_publish(\n            exchange=\'\',\n            routing_key=\'rpc_queue\',\n            properties=pika.BasicProperties(\n                reply_to=self.callback_queue,\n                correlation_id=self.corr_id,\n            ),\n            body=json.dumps({\'n\': n})\n        )\n\n        # \uc751\ub2f5 \ub300\uae30\n        while self.response is None:\n            self.connection.process_data_events()\n\n        return self.response[\'result\']\n\n# \uc0ac\uc6a9 \uc608\nfibonacci_rpc = FibonacciRpcClient()\n\nprint(" [x] Requesting fib(30)")\nresponse = fibonacci_rpc.call(30)\nprint(f" [.] Got {response}")\n'})}),"\n",(0,c.jsx)(n.h3,{id:"\ud14c\uc2a4\ud2b8-\ucf54\ub4dc",children:"\ud14c\uc2a4\ud2b8 \ucf54\ub4dc"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:'# test_rpc.py\nimport pytest\nfrom rpc_client import FibonacciRpcClient\n\ndef test_fibonacci_rpc():\n    """RPC \ud638\ucd9c \ud14c\uc2a4\ud2b8"""\n    client = FibonacciRpcClient()\n\n    # fib(10) = 55\n    result = client.call(10)\n    assert result == 55\n\n    # fib(15) = 610\n    result = client.call(15)\n    assert result == 610\n'})}),"\n",(0,c.jsx)(n.h2,{id:"-\ud575\uc2ec-\uac1c\ub150",children:"\ud83d\udca1 \ud575\uc2ec \uac1c\ub150"}),"\n",(0,c.jsx)(n.h3,{id:"correlation-id",children:"Correlation ID"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"# \uc694\uccad\ub9c8\ub2e4 \uace0\uc720 ID \uc0dd\uc131\ncorr_id = str(uuid.uuid4())\n\n# \uc751\ub2f5 \uc2dc \uac19\uc740 ID\ub85c \ub9e4\uce6d\nif self.corr_id == props.correlation_id:\n    self.response = body\n"})}),"\n",(0,c.jsx)(n.h3,{id:"reply-queue",children:"Reply Queue"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"# \uc784\uc2dc \ud050 \uc0dd\uc131 (exclusive=True)\nresult = channel.queue_declare(queue='', exclusive=True)\ncallback_queue = result.method.queue\n"})}),"\n",(0,c.jsx)(n.h2,{id:"-\ub2e4\uc74c-\ub2e8\uacc4",children:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4"}),"\n",(0,c.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,c.jsx)(n.a,{href:"./dead-letter-exchange",children:"Dead Letter Exchange"})]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>t});var i=r(6540);const c={},l=i.createContext(c);function s(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);