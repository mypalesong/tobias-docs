"use strict";(globalThis.webpackChunkgithub_docs=globalThis.webpackChunkgithub_docs||[]).push([[2864],{6587:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"rabbitmq/basic/work-queues","title":"Work Queue - \uc791\uc5c5 \ubd84\ubc30","description":"\uc5ec\ub7ec \uc6cc\ucee4\uc5d0\uac8c \uc791\uc5c5\uc744 \ubd84\ubc30\ud558\ub294 \ud328\ud134\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!","source":"@site/docs/rabbitmq/basic/work-queues.md","sourceDirName":"rabbitmq/basic","slug":"/rabbitmq/basic/work-queues","permalink":"/docs/rabbitmq/basic/work-queues","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rabbitmq/basic/work-queues.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"rabbitmqSidebar","previous":{"title":"Hello World - \uccab \uba54\uc2dc\uc9c0","permalink":"/docs/rabbitmq/basic/hello-world"},"next":{"title":"Publish/Subscribe - \ube0c\ub85c\ub4dc\uce90\uc2a4\ud305","permalink":"/docs/rabbitmq/basic/publish-subscribe"}}');var a=s(4848),r=s(8453);const t={sidebar_position:5},c="Work Queue - \uc791\uc5c5 \ubd84\ubc30",l={},o=[{value:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c",id:"-\ud559\uc2b5-\ubaa9\ud45c",level:2},{value:"\ud83d\udcca \ud328\ud134 \uad6c\uc870",id:"-\ud328\ud134-\uad6c\uc870",level:2},{value:"\ud83d\udcdd \uc2dc\ub098\ub9ac\uc624",id:"-\uc2dc\ub098\ub9ac\uc624",level:2},{value:"\ud83d\udd27 \uad6c\ud604",id:"-\uad6c\ud604",level:2},{value:"Producer (\uc791\uc5c5 \uc0dd\uc131)",id:"producer-\uc791\uc5c5-\uc0dd\uc131",level:3},{value:"Consumer (\uc6cc\ucee4)",id:"consumer-\uc6cc\ucee4",level:3},{value:"\ud83e\uddea \ud14c\uc2a4\ud2b8 \ucf54\ub4dc",id:"-\ud14c\uc2a4\ud2b8-\ucf54\ub4dc",level:2},{value:"\ud83c\udfa8 \uc2e4\ud589 \uc608\uc81c",id:"-\uc2e4\ud589-\uc608\uc81c",level:2},{value:"1. \uc6cc\ucee4 3\uac1c \uc2e4\ud589",id:"1-\uc6cc\ucee4-3\uac1c-\uc2e4\ud589",level:3},{value:"2. \uc791\uc5c5 \ubc1c\ud589",id:"2-\uc791\uc5c5-\ubc1c\ud589",level:3},{value:"\ud83d\udca1 \ud575\uc2ec \uac1c\ub150",id:"-\ud575\uc2ec-\uac1c\ub150",level:2},{value:"1. Message Acknowledgment",id:"1-message-acknowledgment",level:3},{value:"2. Message Durability",id:"2-message-durability",level:3},{value:"3. Fair Dispatch",id:"3-fair-dispatch",level:3},{value:"\ud83d\udd0d \ube44\uad50",id:"-\ube44\uad50",level:2},{value:"Round-robin (\uae30\ubcf8)",id:"round-robin-\uae30\ubcf8",level:3},{value:"Fair Dispatch",id:"fair-dispatch",level:3},{value:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d",id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",level:2},{value:"1. ACK\ub97c \uc78a\uc9c0 \ub9d0 \uac83",id:"1-ack\ub97c-\uc78a\uc9c0-\ub9d0-\uac83",level:3},{value:"2. \ucc98\ub9ac \uc2e4\ud328 \uc2dc NACK",id:"2-\ucc98\ub9ac-\uc2e4\ud328-\uc2dc-nack",level:3},{value:"3. \ud0c0\uc784\uc544\uc6c3 \uc124\uc815",id:"3-\ud0c0\uc784\uc544\uc6c3-\uc124\uc815",level:3},{value:"\ud83d\udcca \ubaa8\ub2c8\ud130\ub9c1",id:"-\ubaa8\ub2c8\ud130\ub9c1",level:2},{value:"Management UI\uc5d0\uc11c \ud655\uc778",id:"management-ui\uc5d0\uc11c-\ud655\uc778",level:3},{value:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c",id:"-\uc2e4\uc2b5-\uacfc\uc81c",level:2},{value:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac",id:"-\ud575\uc2ec-\uc815\ub9ac",level:2},{value:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4",id:"-\ub2e4\uc74c-\ub2e8\uacc4",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"work-queue---\uc791\uc5c5-\ubd84\ubc30",children:"Work Queue - \uc791\uc5c5 \ubd84\ubc30"})}),"\n",(0,a.jsx)(n.p,{children:"\uc5ec\ub7ec \uc6cc\ucee4\uc5d0\uac8c \uc791\uc5c5\uc744 \ubd84\ubc30\ud558\ub294 \ud328\ud134\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!"}),"\n",(0,a.jsx)(n.h2,{id:"-\ud559\uc2b5-\ubaa9\ud45c",children:"\ud83c\udfaf \ud559\uc2b5 \ubaa9\ud45c"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Work Queue \ud328\ud134 \uc774\ud574"}),"\n",(0,a.jsx)(n.li,{children:"Round-robin \ubd84\ubc30 \ubc29\uc2dd"}),"\n",(0,a.jsx)(n.li,{children:"Message Acknowledgment"}),"\n",(0,a.jsx)(n.li,{children:"Fair Dispatch (\uacf5\uc815\ud55c \ubd84\ubc30)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\ud328\ud134-\uad6c\uc870",children:"\ud83d\udcca \ud328\ud134 \uad6c\uc870"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Producer  --\x3e  [Task Queue]  --\x3e  Worker 1\n                               --\x3e  Worker 2\n                               --\x3e  Worker 3\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\ud2b9\uc9d5"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["1",":N"," \ud1b5\uc2e0"]}),"\n",(0,a.jsx)(n.li,{children:"\ubd80\ud558 \ubd84\uc0b0"}),"\n",(0,a.jsx)(n.li,{children:"\ubcd1\ub82c \ucc98\ub9ac"}),"\n",(0,a.jsx)(n.li,{children:"\ud655\uc7a5 \uac00\ub2a5"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\uc2dc\ub098\ub9ac\uc624",children:"\ud83d\udcdd \uc2dc\ub098\ub9ac\uc624"}),"\n",(0,a.jsx)(n.p,{children:"\uc774\ubbf8\uc9c0 \ub9ac\uc0ac\uc774\uc9d5 \uc791\uc5c5\uc744 \uc5ec\ub7ec \uc6cc\ucee4\uac00 \ucc98\ub9ac:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\uc6d0\ubcf8 \uc774\ubbf8\uc9c0 \uc5c5\ub85c\ub4dc \u2192 \ud050\uc5d0 \uc791\uc5c5 \ucd94\uac00"}),"\n",(0,a.jsx)(n.li,{children:"\uc5ec\ub7ec \uc6cc\ucee4\uac00 \ubcd1\ub82c\ub85c \ub9ac\uc0ac\uc774\uc9d5"}),"\n",(0,a.jsx)(n.li,{children:"\uc644\ub8cc\ub41c \uc791\uc5c5\uc740 \uc790\ub3d9 \ud655\uc778"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\uad6c\ud604",children:"\ud83d\udd27 \uad6c\ud604"}),"\n",(0,a.jsx)(n.h3,{id:"producer-\uc791\uc5c5-\uc0dd\uc131",children:"Producer (\uc791\uc5c5 \uc0dd\uc131)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# task_producer.py\nimport pika\nimport sys\nimport json\n\ndef send_task(task_name: str, difficulty: int):\n    \"\"\"\uc791\uc5c5\uc744 \ud050\uc5d0 \ucd94\uac00\"\"\"\n    connection = pika.BlockingConnection(\n        pika.ConnectionParameters('localhost')\n    )\n    channel = connection.channel()\n\n    # \ud050 \uc120\uc5b8 (durable=True\ub85c \uc601\uc18d\uc131 \ubcf4\uc7a5)\n    channel.queue_declare(queue='task_queue', durable=True)\n\n    # \uc791\uc5c5 \ub370\uc774\ud130\n    task_data = {\n        'name': task_name,\n        'difficulty': difficulty,\n        'dots': '.' * difficulty  # \uc2dc\ubbac\ub808\uc774\uc158\uc6a9\n    }\n\n    message = json.dumps(task_data)\n\n    # \uba54\uc2dc\uc9c0 \ubc1c\ud589\n    channel.basic_publish(\n        exchange='',\n        routing_key='task_queue',\n        body=message,\n        properties=pika.BasicProperties(\n            delivery_mode=2,  # \uba54\uc2dc\uc9c0\ub97c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\n        )\n    )\n\n    print(f\" [x] Sent task: {task_name} (difficulty: {difficulty})\")\n    connection.close()\n\nif __name__ == '__main__':\n    # \uc5ec\ub7ec \uc791\uc5c5 \uc0dd\uc131\n    tasks = [\n        ('resize_photo_1.jpg', 2),\n        ('resize_photo_2.jpg', 5),\n        ('resize_photo_3.jpg', 1),\n        ('resize_photo_4.jpg', 8),\n        ('resize_photo_5.jpg', 3),\n    ]\n\n    for task_name, difficulty in tasks:\n        send_task(task_name, difficulty)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"consumer-\uc6cc\ucee4",children:"Consumer (\uc6cc\ucee4)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# task_worker.py\nimport pika\nimport time\nimport json\nimport sys\n\ndef callback(ch, method, properties, body):\n    \"\"\"\uc791\uc5c5 \ucc98\ub9ac \ucf5c\ubc31\"\"\"\n    task_data = json.loads(body.decode())\n    task_name = task_data['name']\n    difficulty = task_data['difficulty']\n\n    print(f\" [x] Received task: {task_name}\")\n\n    # \uc791\uc5c5 \ucc98\ub9ac \uc2dc\ubbac\ub808\uc774\uc158 (\ub09c\uc774\ub3c4\ub9cc\ud07c \uc2dc\uac04 \uc18c\uc694)\n    time.sleep(difficulty)\n\n    print(f\" [\u2713] Done: {task_name}\")\n\n    # \uc791\uc5c5 \uc644\ub8cc \ud655\uc778 (ACK)\n    ch.basic_ack(delivery_tag=method.delivery_tag)\n\ndef start_worker(worker_id: int):\n    \"\"\"\uc6cc\ucee4 \uc2dc\uc791\"\"\"\n    connection = pika.BlockingConnection(\n        pika.ConnectionParameters('localhost')\n    )\n    channel = connection.channel()\n\n    channel.queue_declare(queue='task_queue', durable=True)\n\n    # Fair dispatch: \ud55c \ubc88\uc5d0 1\uac1c\uc529\ub9cc \ucc98\ub9ac\n    channel.basic_qos(prefetch_count=1)\n\n    channel.basic_consume(\n        queue='task_queue',\n        on_message_callback=callback\n    )\n\n    print(f' [*] Worker {worker_id} waiting for tasks...')\n    channel.start_consuming()\n\nif __name__ == '__main__':\n    worker_id = int(sys.argv[1]) if len(sys.argv) > 1 else 1\n    try:\n        start_worker(worker_id)\n    except KeyboardInterrupt:\n        print(f'\\nWorker {worker_id} stopped')\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\ud14c\uc2a4\ud2b8-\ucf54\ub4dc",children:"\ud83e\uddea \ud14c\uc2a4\ud2b8 \ucf54\ub4dc"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# test_work_queue.py\nimport pytest\nimport pika\nimport json\nimport time\nfrom threading import Thread\nfrom task_producer import send_task\n\nclass TestWorkQueue:\n    \"\"\"Work Queue \ud14c\uc2a4\ud2b8\"\"\"\n\n    @pytest.fixture\n    def setup_queue(self):\n        \"\"\"\ud14c\uc2a4\ud2b8 \ud050 \uc124\uc815\"\"\"\n        connection = pika.BlockingConnection(\n            pika.ConnectionParameters('localhost')\n        )\n        channel = connection.channel()\n        channel.queue_delete(queue='test_task_queue')\n        channel.queue_declare(queue='test_task_queue', durable=True)\n        yield channel\n        channel.queue_delete(queue='test_task_queue')\n        connection.close()\n\n    def test_multiple_tasks(self, setup_queue):\n        \"\"\"\uc5ec\ub7ec \uc791\uc5c5 \ubc1c\ud589 \ud14c\uc2a4\ud2b8\"\"\"\n        channel = setup_queue\n\n        # 3\uac1c \uc791\uc5c5 \ubc1c\ud589\n        for i in range(3):\n            task_data = {'name': f'task_{i}', 'difficulty': 1}\n            channel.basic_publish(\n                exchange='',\n                routing_key='test_task_queue',\n                body=json.dumps(task_data),\n                properties=pika.BasicProperties(delivery_mode=2)\n            )\n\n        # \ud050 \uc0c1\ud0dc \ud655\uc778\n        queue_state = channel.queue_declare(\n            queue='test_task_queue',\n            passive=True\n        )\n        assert queue_state.method.message_count == 3\n\n    def test_task_processing(self, setup_queue):\n        \"\"\"\uc791\uc5c5 \ucc98\ub9ac \ud14c\uc2a4\ud2b8\"\"\"\n        channel = setup_queue\n        processed_tasks = []\n\n        def callback(ch, method, properties, body):\n            task_data = json.loads(body.decode())\n            processed_tasks.append(task_data['name'])\n            ch.basic_ack(delivery_tag=method.delivery_tag)\n\n        # Consumer \uc124\uc815\n        channel.basic_consume(\n            queue='test_task_queue',\n            on_message_callback=callback\n        )\n\n        # \uc791\uc5c5 \ubc1c\ud589\n        task_data = {'name': 'test_task', 'difficulty': 1}\n        channel.basic_publish(\n            exchange='',\n            routing_key='test_task_queue',\n            body=json.dumps(task_data),\n            properties=pika.BasicProperties(delivery_mode=2)\n        )\n\n        # \uba54\uc2dc\uc9c0 \ucc98\ub9ac\n        connection = channel.connection\n        connection.process_data_events(time_limit=1)\n\n        assert 'test_task' in processed_tasks\n\n    def test_fair_dispatch(self, setup_queue):\n        \"\"\"\uacf5\uc815\ud55c \ubd84\ubc30 \ud14c\uc2a4\ud2b8\"\"\"\n        channel = setup_queue\n\n        # prefetch_count \uc124\uc815\n        channel.basic_qos(prefetch_count=1)\n\n        # \uc5ec\ub7ec \uc791\uc5c5 \ubc1c\ud589\n        for i in range(5):\n            task_data = {'name': f'task_{i}', 'difficulty': i+1}\n            channel.basic_publish(\n                exchange='',\n                routing_key='test_task_queue',\n                body=json.dumps(task_data),\n                properties=pika.BasicProperties(delivery_mode=2)\n            )\n\n        # \ud050\uc5d0 5\uac1c \uba54\uc2dc\uc9c0 \ud655\uc778\n        queue_state = channel.queue_declare(\n            queue='test_task_queue',\n            passive=True\n        )\n        assert queue_state.method.message_count == 5\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\uc2e4\ud589-\uc608\uc81c",children:"\ud83c\udfa8 \uc2e4\ud589 \uc608\uc81c"}),"\n",(0,a.jsx)(n.h3,{id:"1-\uc6cc\ucee4-3\uac1c-\uc2e4\ud589",children:"1. \uc6cc\ucee4 3\uac1c \uc2e4\ud589"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \ud130\ubbf8\ub110 1\npython task_worker.py 1\n\n# \ud130\ubbf8\ub110 2\npython task_worker.py 2\n\n# \ud130\ubbf8\ub110 3\npython task_worker.py 3\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\uc791\uc5c5-\ubc1c\ud589",children:"2. \uc791\uc5c5 \ubc1c\ud589"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \ud130\ubbf8\ub110 4\npython task_producer.py\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\ucd9c\ub825 (\uac01 \uc6cc\ucee4)"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"# Worker 1\n[*] Worker 1 waiting for tasks...\n[x] Received task: resize_photo_1.jpg\n[\u2713] Done: resize_photo_1.jpg\n[x] Received task: resize_photo_4.jpg\n[\u2713] Done: resize_photo_4.jpg\n\n# Worker 2\n[*] Worker 2 waiting for tasks...\n[x] Received task: resize_photo_2.jpg\n[\u2713] Done: resize_photo_2.jpg\n\n# Worker 3\n[*] Worker 3 waiting for tasks...\n[x] Received task: resize_photo_3.jpg\n[\u2713] Done: resize_photo_3.jpg\n[x] Received task: resize_photo_5.jpg\n[\u2713] Done: resize_photo_5.jpg\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\ud575\uc2ec-\uac1c\ub150",children:"\ud83d\udca1 \ud575\uc2ec \uac1c\ub150"}),"\n",(0,a.jsx)(n.h3,{id:"1-message-acknowledgment",children:"1. Message Acknowledgment"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# auto_ack=False (\uae30\ubcf8\uac12): \uc218\ub3d9 \ud655\uc778\nchannel.basic_consume(\n    queue='task_queue',\n    on_message_callback=callback,\n    auto_ack=False  # \uc218\ub3d9 ACK\n)\n\n# \uc791\uc5c5 \uc644\ub8cc \ud6c4 ACK\nch.basic_ack(delivery_tag=method.delivery_tag)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\uc65c \uc218\ub3d9 ACK?"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\uc6cc\ucee4\uac00 \uc8fd\uc73c\uba74 \uba54\uc2dc\uc9c0 \uc7ac\uc804\uc1a1"}),"\n",(0,a.jsx)(n.li,{children:"\ucc98\ub9ac \uc644\ub8cc\ub97c \ud655\uc2e4\ud788 \ubcf4\uc7a5"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-message-durability",children:"2. Message Durability"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# \ud050 \uc601\uc18d\uc131\nchannel.queue_declare(queue='task_queue', durable=True)\n\n# \uba54\uc2dc\uc9c0 \uc601\uc18d\uc131\nchannel.basic_publish(\n    exchange='',\n    routing_key='task_queue',\n    body=message,\n    properties=pika.BasicProperties(\n        delivery_mode=2,  # persistent\n    )\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-fair-dispatch",children:"3. Fair Dispatch"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# prefetch_count=1: \ud55c \ubc88\uc5d0 1\uac1c\uc529\ub9cc\nchannel.basic_qos(prefetch_count=1)\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\ud6a8\uacfc"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\ube60\ub978 \uc6cc\ucee4\ub294 \ub354 \ub9ce\uc740 \uc791\uc5c5 \ucc98\ub9ac"}),"\n",(0,a.jsx)(n.li,{children:"\ub290\ub9b0 \uc6cc\ucee4\ub294 \uc801\uc740 \uc791\uc5c5 \ucc98\ub9ac"}),"\n",(0,a.jsx)(n.li,{children:"\uc804\uccb4 \ucc98\ub9ac\ub7c9 \ucd5c\uc801\ud654"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\ube44\uad50",children:"\ud83d\udd0d \ube44\uad50"}),"\n",(0,a.jsx)(n.h3,{id:"round-robin-\uae30\ubcf8",children:"Round-robin (\uae30\ubcf8)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# prefetch_count \uc124\uc815 \uc5c6\uc74c\n# \u2192 \ubaa8\ub4e0 \uc6cc\ucee4\uc5d0\uac8c \uade0\ub4f1 \ubd84\ubc30\n# \u2192 \ube60\ub978 \uc6cc\ucee4\uac00 \ub300\uae30\ud558\uac8c \ub428\n\nWorker 1: [Task 1] [Task 4] [Task 7]  (fast)\nWorker 2: [Task 2] [Task 5] [Task 8]  (slow)\nWorker 3: [Task 3] [Task 6] [Task 9]  (medium)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"fair-dispatch",children:"Fair Dispatch"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"channel.basic_qos(prefetch_count=1)\n# \u2192 \ucc98\ub9ac \uc18d\ub3c4\uc5d0 \ub530\ub77c \ubd84\ubc30\n# \u2192 \ud6a8\uc728\uc801\uc778 \ubd80\ud558 \ubd84\uc0b0\n\nWorker 1: [Task 1] [Task 4] [Task 6] [Task 8] (fast)\nWorker 2: [Task 2] [Task 7]                   (slow)\nWorker 3: [Task 3] [Task 5] [Task 9]          (medium)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-\uc8fc\uc758\uc0ac\ud56d",children:"\u26a0\ufe0f \uc8fc\uc758\uc0ac\ud56d"}),"\n",(0,a.jsx)(n.h3,{id:"1-ack\ub97c-\uc78a\uc9c0-\ub9d0-\uac83",children:"1. ACK\ub97c \uc78a\uc9c0 \ub9d0 \uac83"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# \u274c \uc704\ud5d8: ACK \uc5c6\uc74c \u2192 \uba54\ubaa8\ub9ac \ub204\uc218\ndef callback(ch, method, properties, body):\n    process_task(body)\n    # ch.basic_ack() \ub204\ub77d!\n\n# \u2705 \uc62c\ubc14\ub984\ndef callback(ch, method, properties, body):\n    process_task(body)\n    ch.basic_ack(delivery_tag=method.delivery_tag)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\ucc98\ub9ac-\uc2e4\ud328-\uc2dc-nack",children:"2. \ucc98\ub9ac \uc2e4\ud328 \uc2dc NACK"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def callback(ch, method, properties, body):\n    try:\n        process_task(body)\n        ch.basic_ack(delivery_tag=method.delivery_tag)\n    except Exception as e:\n        print(f"Error: {e}")\n        # \uc7ac\uc2dc\ub3c4\ub97c \uc704\ud574 NACK\n        ch.basic_nack(\n            delivery_tag=method.delivery_tag,\n            requeue=True\n        )\n'})}),"\n",(0,a.jsx)(n.h3,{id:"3-\ud0c0\uc784\uc544\uc6c3-\uc124\uc815",children:"3. \ud0c0\uc784\uc544\uc6c3 \uc124\uc815"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# \uc6cc\ucee4\uac00 \uc624\ub798 \uac78\ub9ac\ub294 \uc791\uc5c5 \ucc98\ub9ac \uc2dc\nconnection = pika.BlockingConnection(\n    pika.ConnectionParameters(\n        host='localhost',\n        heartbeat=600,  # 10\ubd84\n        blocked_connection_timeout=300\n    )\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\ubaa8\ub2c8\ud130\ub9c1",children:"\ud83d\udcca \ubaa8\ub2c8\ud130\ub9c1"}),"\n",(0,a.jsx)(n.h3,{id:"management-ui\uc5d0\uc11c-\ud655\uc778",children:"Management UI\uc5d0\uc11c \ud655\uc778"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Queues \ud0ed"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Ready: \ub300\uae30 \uc911\uc778 \uba54\uc2dc\uc9c0 \uc218"}),"\n",(0,a.jsx)(n.li,{children:"Unacked: \ucc98\ub9ac \uc911\uc778 \uba54\uc2dc\uc9c0 \uc218"}),"\n",(0,a.jsx)(n.li,{children:"Message rate: \ucd08\ub2f9 \ucc98\ub9ac\uc728"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Consumers \ud0ed"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\uac01 \uc6cc\ucee4\uc758 \uc0c1\ud0dc"}),"\n",(0,a.jsx)(n.li,{children:"Prefetch count \uc124\uc815"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\uc2e4\uc2b5-\uacfc\uc81c",children:"\u2705 \uc2e4\uc2b5 \uacfc\uc81c"}),"\n",(0,a.jsx)(n.p,{children:"\ub2e4\uc74c \uc2dc\uc2a4\ud15c\uc744 \uad6c\ud604\ud558\uc138\uc694:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\ube44\ub514\uc624 \uc778\ucf54\ub529 \uc791\uc5c5 \ud050","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\ub2e4\uc591\ud55c \ud574\uc0c1\ub3c4 (480p, 720p, 1080p)"}),"\n",(0,a.jsx)(n.li,{children:"\ud574\uc0c1\ub3c4\uc5d0 \ub530\ub77c \ucc98\ub9ac \uc2dc\uac04 \ub2e4\ub984"}),"\n",(0,a.jsx)(n.li,{children:"3\uac1c \uc6cc\ucee4\ub85c \ubcd1\ub82c \ucc98\ub9ac"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"\uc815\ub2f5 \ubcf4\uae30"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# video_encoder.py\nimport pika\nimport time\nimport json\n\ndef encode_video(ch, method, properties, body):\n    video_data = json.loads(body.decode())\n    filename = video_data['filename']\n    resolution = video_data['resolution']\n\n    print(f\" [x] Encoding {filename} to {resolution}\")\n\n    # \ud574\uc0c1\ub3c4\ubcc4 \ucc98\ub9ac \uc2dc\uac04\n    encoding_time = {\n        '480p': 2,\n        '720p': 5,\n        '1080p': 10\n    }\n\n    time.sleep(encoding_time.get(resolution, 2))\n    print(f\" [\u2713] Done: {filename} ({resolution})\")\n\n    ch.basic_ack(delivery_tag=method.delivery_tag)\n\nconnection = pika.BlockingConnection(\n    pika.ConnectionParameters('localhost')\n)\nchannel = connection.channel()\nchannel.queue_declare(queue='video_encoding', durable=True)\nchannel.basic_qos(prefetch_count=1)\n\nchannel.basic_consume(\n    queue='video_encoding',\n    on_message_callback=encode_video\n)\n\nprint(' [*] Waiting for encoding tasks...')\nchannel.start_consuming()\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"-\ud575\uc2ec-\uc815\ub9ac",children:"\ud83d\udcda \ud575\uc2ec \uc815\ub9ac"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Work Queue"}),": \uc5ec\ub7ec \uc6cc\ucee4\uc5d0\uac8c \uc791\uc5c5 \ubd84\ubc30"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Message ACK"}),": \ucc98\ub9ac \uc644\ub8cc \ud655\uc778"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Durability"}),": \ud050\uc640 \uba54\uc2dc\uc9c0 \uc601\uc18d\ud654"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fair Dispatch"}),": \uacf5\uc815\ud55c \ubd80\ud558 \ubd84\uc0b0 (prefetch_count=1)"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-\ub2e4\uc74c-\ub2e8\uacc4",children:"\ud83d\udcda \ub2e4\uc74c \ub2e8\uacc4"}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,a.jsx)(n.a,{href:"./publish-subscribe",children:"Publish/Subscribe - \ube0c\ub85c\ub4dc\uce90\uc2a4\ud305"})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var i=s(6540);const a={},r=i.createContext(a);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);