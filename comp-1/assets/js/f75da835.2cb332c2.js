"use strict";(globalThis.webpackChunkgithub_docs=globalThis.webpackChunkgithub_docs||[]).push([[4518],{8453:(n,e,E)=>{E.d(e,{R:()=>d,x:()=>t});var s=E(6540);const r={},i=s.createContext(r);function d(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),s.createElement(i.Provider,{value:e},n.children)}},9657:(n,e,E)=>{E.r(e),E.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>o,frontMatter:()=>d,metadata:()=>s,toc:()=>T});const s=JSON.parse('{"id":"database/scenarios/ecommerce","title":"\uc804\uc790\uc0c1\uac70\ub798 \uc2dc\uc2a4\ud15c","description":"\uc644\uc804\ud55c \uc804\uc790\uc0c1\uac70\ub798 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc124\uacc4 \uc608\uc2dc","source":"@site/docs/database/scenarios/ecommerce.md","sourceDirName":"database/scenarios","slug":"/database/scenarios/ecommerce","permalink":"/docs/database/scenarios/ecommerce","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/database/scenarios/ecommerce.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"slug":"/database/scenarios/ecommerce"},"sidebar":"databaseSidebar","previous":{"title":"PostgreSQL \ud559\uc2b5 \uac00\uc774\ub4dc","permalink":"/docs/database/postgres/intro"}}');var r=E(4848),i=E(8453);const d={sidebar_position:1,slug:"/database/scenarios/ecommerce"},t="\uc804\uc790\uc0c1\uac70\ub798 \uc2dc\uc2a4\ud15c",a={},T=[{value:"\ud83c\udfaf \uc694\uad6c\uc0ac\ud56d \ubd84\uc11d",id:"-\uc694\uad6c\uc0ac\ud56d-\ubd84\uc11d",level:2},{value:"\ud575\uc2ec \uae30\ub2a5",id:"\ud575\uc2ec-\uae30\ub2a5",level:3},{value:"\ud83d\udcca \uc5d4\ud2f0\ud2f0 \uad00\uacc4\ub3c4 (ERD)",id:"-\uc5d4\ud2f0\ud2f0-\uad00\uacc4\ub3c4-erd",level:2},{value:"\ud83d\udd27 \uc2a4\ud0a4\ub9c8 \uc124\uacc4",id:"-\uc2a4\ud0a4\ub9c8-\uc124\uacc4",level:2},{value:"1. \uc0ac\uc6a9\uc790 \ubc0f \uc778\uc99d",id:"1-\uc0ac\uc6a9\uc790-\ubc0f-\uc778\uc99d",level:3},{value:"2. \uc0c1\ud488 \ubc0f \uce74\ud14c\uace0\ub9ac",id:"2-\uc0c1\ud488-\ubc0f-\uce74\ud14c\uace0\ub9ac",level:3},{value:"3. \uc7a5\ubc14\uad6c\ub2c8",id:"3-\uc7a5\ubc14\uad6c\ub2c8",level:3},{value:"4. \uc8fc\ubb38 \ubc0f \uacb0\uc81c",id:"4-\uc8fc\ubb38-\ubc0f-\uacb0\uc81c",level:3},{value:"5. \ub9ac\ubdf0 \ubc0f \ud3c9\uc810",id:"5-\ub9ac\ubdf0-\ubc0f-\ud3c9\uc810",level:3},{value:"6. \ucfe0\ud3f0 \ubc0f \ud504\ub85c\ubaa8\uc158",id:"6-\ucfe0\ud3f0-\ubc0f-\ud504\ub85c\ubaa8\uc158",level:3},{value:"\ud83d\udd27 \ud2b8\ub9ac\uac70 \ubc0f \ud568\uc218",id:"-\ud2b8\ub9ac\uac70-\ubc0f-\ud568\uc218",level:2},{value:"\uc8fc\ubb38 \uc0dd\uc131 \ud568\uc218",id:"\uc8fc\ubb38-\uc0dd\uc131-\ud568\uc218",level:3},{value:"\uc0c1\ud488 \ud3c9\uc810 \uc790\ub3d9 \uac31\uc2e0",id:"\uc0c1\ud488-\ud3c9\uc810-\uc790\ub3d9-\uac31\uc2e0",level:3},{value:"\ud83d\udcca \uc8fc\uc694 \ucffc\ub9ac",id:"-\uc8fc\uc694-\ucffc\ub9ac",level:2},{value:"\uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c",id:"\uc0c1\ud488-\ubaa9\ub85d-\uc870\ud68c",level:3},{value:"\uc8fc\ubb38 \uc0c1\uc138 \uc870\ud68c",id:"\uc8fc\ubb38-\uc0c1\uc138-\uc870\ud68c",level:3},{value:"\u2705 \ucd5c\uc801\ud654 \ud3ec\uc778\ud2b8",id:"-\ucd5c\uc801\ud654-\ud3ec\uc778\ud2b8",level:2},{value:"\uc778\ub371\uc2a4 \uc804\ub7b5",id:"\uc778\ub371\uc2a4-\uc804\ub7b5",level:3},{value:"\ud30c\ud2f0\uc154\ub2dd",id:"\ud30c\ud2f0\uc154\ub2dd",level:3},{value:"\ud83d\ude80 \ub2e4\uc74c \ub2e8\uacc4",id:"-\ub2e4\uc74c-\ub2e8\uacc4",level:2}];function _(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\uc804\uc790\uc0c1\uac70\ub798-\uc2dc\uc2a4\ud15c",children:"\uc804\uc790\uc0c1\uac70\ub798 \uc2dc\uc2a4\ud15c"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\uc644\uc804\ud55c \uc804\uc790\uc0c1\uac70\ub798 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc124\uacc4 \uc608\uc2dc"})}),"\n",(0,r.jsx)(e.p,{children:"\uc804\uc790\uc0c1\uac70\ub798\ub294 \uac00\uc7a5 \ubcf5\uc7a1\ud55c \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc124\uacc4 \uc911 \ud558\ub098\uc785\ub2c8\ub2e4. \uc0ac\uc6a9\uc790, \uc0c1\ud488, \uc8fc\ubb38, \uacb0\uc81c, \uc7ac\uace0, \ub9ac\ubdf0 \ub4f1 \ub2e4\uc591\ud55c \ub3c4\uba54\uc778\uc744 \ub2e4\ub8f9\ub2c8\ub2e4."}),"\n",(0,r.jsx)(e.h2,{id:"-\uc694\uad6c\uc0ac\ud56d-\ubd84\uc11d",children:"\ud83c\udfaf \uc694\uad6c\uc0ac\ud56d \ubd84\uc11d"}),"\n",(0,r.jsx)(e.h3,{id:"\ud575\uc2ec-\uae30\ub2a5",children:"\ud575\uc2ec \uae30\ub2a5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'ecommerce_features = {\n    "\uc0ac\uc6a9\uc790 \uad00\ub9ac": "\ud68c\uc6d0\uac00\uc785, \ub85c\uadf8\uc778, \ud504\ub85c\ud544, \uc8fc\uc18c\ub85d",\n    "\uc0c1\ud488 \uad00\ub9ac": "\uce74\ud14c\uace0\ub9ac, \uc0c1\ud488, \uc7ac\uace0, \uac00\uaca9, \uc774\ubbf8\uc9c0",\n    "\uc7a5\ubc14\uad6c\ub2c8": "\uc0c1\ud488 \ub2f4\uae30, \uc218\ub7c9 \uc870\uc808, \ucfe0\ud3f0 \uc801\uc6a9",\n    "\uc8fc\ubb38/\uacb0\uc81c": "\uc8fc\ubb38 \uc0dd\uc131, \uacb0\uc81c, \ubc30\uc1a1 \ucd94\uc801",\n    "\ub9ac\ubdf0/\ud3c9\uc810": "\uc0c1\ud488 \ub9ac\ubdf0, \ud3c9\uc810, \uc774\ubbf8\uc9c0 \ub9ac\ubdf0",\n    "\uac80\uc0c9": "\uc0c1\ud488 \uac80\uc0c9, \ud544\ud130\ub9c1, \uc815\ub82c",\n    "\ud504\ub85c\ubaa8\uc158": "\ucfe0\ud3f0, \ud560\uc778, \ud2b9\uac00"\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"-\uc5d4\ud2f0\ud2f0-\uad00\uacc4\ub3c4-erd",children:"\ud83d\udcca \uc5d4\ud2f0\ud2f0 \uad00\uacc4\ub3c4 (ERD)"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-mermaid",children:"erDiagram\n    USERS ||--o{ ORDERS : places\n    USERS ||--o{ REVIEWS : writes\n    USERS ||--o{ CART_ITEMS : has\n    USERS ||--o{ USER_ADDRESSES : has\n\n    PRODUCTS ||--o{ ORDER_ITEMS : contains\n    PRODUCTS ||--o{ REVIEWS : receives\n    PRODUCTS ||--o{ CART_ITEMS : in\n    PRODUCTS }o--|| CATEGORIES : belongs_to\n\n    ORDERS ||--|{ ORDER_ITEMS : contains\n    ORDERS ||--|| PAYMENTS : has\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\uc2a4\ud0a4\ub9c8-\uc124\uacc4",children:"\ud83d\udd27 \uc2a4\ud0a4\ub9c8 \uc124\uacc4"}),"\n",(0,r.jsx)(e.h3,{id:"1-\uc0ac\uc6a9\uc790-\ubc0f-\uc778\uc99d",children:"1. \uc0ac\uc6a9\uc790 \ubc0f \uc778\uc99d"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \uc0ac\uc6a9\uc790\nCREATE TABLE users (\n    id BIGSERIAL PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    username VARCHAR(50) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n\n    -- \ud504\ub85c\ud544\n    first_name VARCHAR(50),\n    last_name VARCHAR(50),\n    phone VARCHAR(20),\n    date_of_birth DATE,\n\n    -- \uc0c1\ud0dc\n    email_verified BOOLEAN DEFAULT false,\n    is_active BOOLEAN DEFAULT true,\n    is_seller BOOLEAN DEFAULT false,  -- \ud310\ub9e4\uc790 \uc5ec\ubd80\n\n    -- \ud0c0\uc784\uc2a4\ud0ec\ud504\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    last_login_at TIMESTAMPTZ\n);\n\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_username ON users(username);\n\n-- \uc8fc\uc18c\ub85d\nCREATE TABLE user_addresses (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- \uc8fc\uc18c \uc815\ubcf4\n    address_type VARCHAR(20) NOT NULL,  -- 'shipping', 'billing'\n    recipient_name VARCHAR(100) NOT NULL,\n    phone VARCHAR(20) NOT NULL,\n    postal_code VARCHAR(20) NOT NULL,\n    address1 VARCHAR(255) NOT NULL,  -- \uae30\ubcf8 \uc8fc\uc18c\n    address2 VARCHAR(255),  -- \uc0c1\uc138 \uc8fc\uc18c\n    city VARCHAR(100),\n    state VARCHAR(100),\n    country VARCHAR(2) DEFAULT 'KR',  -- ISO 3166-1\n\n    -- \uae30\ubcf8 \uc8fc\uc18c \uc5ec\ubd80\n    is_default BOOLEAN DEFAULT false,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_user_addresses_user ON user_addresses(user_id);\n\n-- \uc0ac\uc6a9\uc790\ub2f9 \ud558\ub098\uc758 \uae30\ubcf8 \ubc30\uc1a1 \uc8fc\uc18c\nCREATE UNIQUE INDEX uq_user_default_shipping\nON user_addresses(user_id)\nWHERE is_default = true AND address_type = 'shipping';\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\uc0c1\ud488-\ubc0f-\uce74\ud14c\uace0\ub9ac",children:"2. \uc0c1\ud488 \ubc0f \uce74\ud14c\uace0\ub9ac"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \uce74\ud14c\uace0\ub9ac (\uacc4\uce35 \uad6c\uc870)\nCREATE TABLE categories (\n    id BIGSERIAL PRIMARY KEY,\n    name VARCHAR(100) NOT NULL,\n    slug VARCHAR(100) UNIQUE NOT NULL,\n    description TEXT,\n    parent_id BIGINT REFERENCES categories(id),\n\n    -- \uc21c\uc11c\n    sort_order INTEGER DEFAULT 0,\n\n    -- \ud65c\uc131\ud654 \uc5ec\ubd80\n    is_active BOOLEAN DEFAULT true,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_categories_parent ON categories(parent_id);\nCREATE INDEX idx_categories_slug ON categories(slug);\n\n-- \uc0c1\ud488\nCREATE TABLE products (\n    id BIGSERIAL PRIMARY KEY,\n    seller_id BIGINT NOT NULL REFERENCES users(id),\n    category_id BIGINT REFERENCES categories(id),\n\n    -- \uae30\ubcf8 \uc815\ubcf4\n    name VARCHAR(200) NOT NULL,\n    slug VARCHAR(200) UNIQUE NOT NULL,\n    description TEXT,\n    short_description VARCHAR(500),\n\n    -- \uac00\uaca9\n    price NUMERIC(10, 2) NOT NULL CHECK (price >= 0),\n    compare_at_price NUMERIC(10, 2) CHECK (compare_at_price >= price),  -- \uc815\uac00\n    cost NUMERIC(10, 2),  -- \uc6d0\uac00 (\uad00\ub9ac\uc6a9)\n\n    -- SKU (Stock Keeping Unit)\n    sku VARCHAR(100) UNIQUE NOT NULL,\n\n    -- \uc7ac\uace0\n    stock_quantity INTEGER NOT NULL DEFAULT 0 CHECK (stock_quantity >= 0),\n    low_stock_threshold INTEGER DEFAULT 10,\n\n    -- \uc18d\uc131\n    weight NUMERIC(10, 2),  -- kg\n    dimensions VARCHAR(50),  -- \"10x20x30 cm\"\n\n    -- \uc0c1\ud0dc\n    status VARCHAR(20) DEFAULT 'draft',  -- 'draft', 'active', 'archived'\n    is_featured BOOLEAN DEFAULT false,\n    is_available BOOLEAN DEFAULT true,\n\n    -- \ud1b5\uacc4 (\uc5ed\uc815\uaddc\ud654)\n    view_count BIGINT DEFAULT 0,\n    order_count INTEGER DEFAULT 0,\n    rating_average NUMERIC(3, 2) DEFAULT 0.00 CHECK (rating_average BETWEEN 0 AND 5),\n    review_count INTEGER DEFAULT 0,\n\n    -- \uba54\ud0c0\ub370\uc774\ud130\n    meta_title VARCHAR(200),\n    meta_description VARCHAR(500),\n    meta_keywords TEXT,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    published_at TIMESTAMPTZ\n);\n\nCREATE INDEX idx_products_seller ON products(seller_id);\nCREATE INDEX idx_products_category ON products(category_id);\nCREATE INDEX idx_products_sku ON products(sku);\nCREATE INDEX idx_products_slug ON products(slug);\nCREATE INDEX idx_products_status ON products(status);\n\n-- \uc804\ubb38 \uac80\uc0c9 \uc778\ub371\uc2a4\nCREATE INDEX idx_products_search\nON products USING GIN (\n    to_tsvector('english', name || ' ' || COALESCE(description, ''))\n);\n\n-- \uc0c1\ud488 \uc774\ubbf8\uc9c0\nCREATE TABLE product_images (\n    id BIGSERIAL PRIMARY KEY,\n    product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,\n\n    url VARCHAR(500) NOT NULL,\n    alt_text VARCHAR(255),\n    sort_order INTEGER DEFAULT 0,\n    is_primary BOOLEAN DEFAULT false,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_product_images_product ON product_images(product_id);\n\n-- \uc0c1\ud488\ub2f9 \ud558\ub098\uc758 \ub300\ud45c \uc774\ubbf8\uc9c0\nCREATE UNIQUE INDEX uq_product_primary_image\nON product_images(product_id)\nWHERE is_primary = true;\n\n-- \uc0c1\ud488 \ubcc0\ud615 (\uc635\uc158)\nCREATE TABLE product_variants (\n    id BIGSERIAL PRIMARY KEY,\n    product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,\n\n    -- \ubcc0\ud615 \uc18d\uc131\n    variant_name VARCHAR(100),  -- \"Red / Large\"\n    options JSONB,  -- {\"color\": \"Red\", \"size\": \"Large\"}\n\n    sku VARCHAR(100) UNIQUE NOT NULL,\n    price NUMERIC(10, 2) NOT NULL CHECK (price >= 0),\n    stock_quantity INTEGER NOT NULL DEFAULT 0,\n\n    is_available BOOLEAN DEFAULT true,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_product_variants_product ON product_variants(product_id);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\uc7a5\ubc14\uad6c\ub2c8",children:"3. \uc7a5\ubc14\uad6c\ub2c8"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE cart_items (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,\n    session_id VARCHAR(255),  -- \ube44\ub85c\uadf8\uc778 \uc0ac\uc6a9\uc790\uc6a9\n\n    product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,\n    variant_id BIGINT REFERENCES product_variants(id) ON DELETE CASCADE,\n\n    quantity INTEGER NOT NULL CHECK (quantity > 0),\n\n    -- \uac00\uaca9 \uc2a4\ub0c5\uc0f7 (\uc7a5\ubc14\uad6c\ub2c8 \ub2f4\uc744 \ub54c \uac00\uaca9)\n    price_snapshot NUMERIC(10, 2) NOT NULL,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\n-- \uc0ac\uc6a9\uc790\ub2f9 \uac19\uc740 \uc0c1\ud488 \uc911\ubcf5 \ubc29\uc9c0\nCREATE UNIQUE INDEX uq_cart_user_product\nON cart_items(user_id, product_id, COALESCE(variant_id, 0))\nWHERE user_id IS NOT NULL;\n\n-- \uc138\uc158\ub2f9 \uac19\uc740 \uc0c1\ud488 \uc911\ubcf5 \ubc29\uc9c0\nCREATE UNIQUE INDEX uq_cart_session_product\nON cart_items(session_id, product_id, COALESCE(variant_id, 0))\nWHERE session_id IS NOT NULL;\n\nCREATE INDEX idx_cart_items_user ON cart_items(user_id);\nCREATE INDEX idx_cart_items_session ON cart_items(session_id);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\uc8fc\ubb38-\ubc0f-\uacb0\uc81c",children:"4. \uc8fc\ubb38 \ubc0f \uacb0\uc81c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \uc8fc\ubb38 \uc0c1\ud0dc ENUM\nCREATE TYPE order_status AS ENUM (\n    'pending',       -- \uacb0\uc81c \ub300\uae30\n    'confirmed',     -- \uacb0\uc81c \uc644\ub8cc\n    'processing',    -- \uc0c1\ud488 \uc900\ube44\uc911\n    'shipped',       -- \ubc30\uc1a1\uc911\n    'delivered',     -- \ubc30\uc1a1 \uc644\ub8cc\n    'cancelled',     -- \ucde8\uc18c\n    'refunded'       -- \ud658\ubd88\n);\n\n-- \uc8fc\ubb38\nCREATE TABLE orders (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT NOT NULL REFERENCES users(id),\n\n    -- \uc8fc\ubb38 \ubc88\ud638 (\uc678\ubd80 \ub178\ucd9c\uc6a9)\n    order_number VARCHAR(50) UNIQUE NOT NULL,\n\n    -- \uae08\uc561\n    subtotal NUMERIC(10, 2) NOT NULL CHECK (subtotal >= 0),  -- \uc0c1\ud488 \ud569\uacc4\n    shipping_fee NUMERIC(10, 2) NOT NULL DEFAULT 0,\n    tax NUMERIC(10, 2) NOT NULL DEFAULT 0,\n    discount NUMERIC(10, 2) NOT NULL DEFAULT 0,\n    total NUMERIC(10, 2) NOT NULL CHECK (total >= 0),  -- \ucd5c\uc885 \uae08\uc561\n\n    -- \ucfe0\ud3f0\n    coupon_code VARCHAR(50),\n    coupon_discount NUMERIC(10, 2) DEFAULT 0,\n\n    -- \ubc30\uc1a1 \uc815\ubcf4\n    shipping_name VARCHAR(100) NOT NULL,\n    shipping_phone VARCHAR(20) NOT NULL,\n    shipping_address VARCHAR(255) NOT NULL,\n    shipping_postal_code VARCHAR(20) NOT NULL,\n    shipping_city VARCHAR(100),\n    shipping_state VARCHAR(100),\n    shipping_country VARCHAR(2) DEFAULT 'KR',\n\n    -- \uba54\ubaa8\n    customer_notes TEXT,\n    admin_notes TEXT,\n\n    -- \uc0c1\ud0dc\n    status order_status DEFAULT 'pending',\n\n    -- \uc0c1\ud0dc\ubcc4 \ud0c0\uc784\uc2a4\ud0ec\ud504\n    confirmed_at TIMESTAMPTZ,\n    processing_at TIMESTAMPTZ,\n    shipped_at TIMESTAMPTZ,\n    delivered_at TIMESTAMPTZ,\n    cancelled_at TIMESTAMPTZ,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_orders_user ON orders(user_id);\nCREATE INDEX idx_orders_number ON orders(order_number);\nCREATE INDEX idx_orders_status ON orders(status);\nCREATE INDEX idx_orders_created ON orders(created_at DESC);\n\n-- \uc8fc\ubb38 \ud56d\ubaa9\nCREATE TABLE order_items (\n    id BIGSERIAL PRIMARY KEY,\n    order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,\n    product_id BIGINT NOT NULL REFERENCES products(id),\n    variant_id BIGINT REFERENCES product_variants(id),\n\n    -- \uc0c1\ud488 \uc815\ubcf4 \uc2a4\ub0c5\uc0f7 (\uc8fc\ubb38 \ub2f9\uc2dc)\n    product_name VARCHAR(200) NOT NULL,\n    variant_name VARCHAR(100),\n    sku VARCHAR(100) NOT NULL,\n\n    -- \uac00\uaca9 \ubc0f \uc218\ub7c9\n    quantity INTEGER NOT NULL CHECK (quantity > 0),\n    unit_price NUMERIC(10, 2) NOT NULL,\n    subtotal NUMERIC(10, 2) NOT NULL,  -- unit_price * quantity\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_order_items_order ON order_items(order_id);\nCREATE INDEX idx_order_items_product ON order_items(product_id);\n\n-- \uacb0\uc81c\nCREATE TABLE payments (\n    id BIGSERIAL PRIMARY KEY,\n    order_id BIGINT UNIQUE NOT NULL REFERENCES orders(id) ON DELETE RESTRICT,\n\n    -- \uacb0\uc81c \uc218\ub2e8\n    payment_method VARCHAR(50) NOT NULL,  -- 'credit_card', 'paypal', 'bank_transfer'\n\n    -- \uae08\uc561\n    amount NUMERIC(10, 2) NOT NULL,\n    currency VARCHAR(3) DEFAULT 'KRW',\n\n    -- \uacb0\uc81c \uac8c\uc774\ud2b8\uc6e8\uc774 \uc815\ubcf4\n    gateway VARCHAR(50),  -- 'stripe', 'toss', 'iamport'\n    transaction_id VARCHAR(255),  -- \uc678\ubd80 \uacb0\uc81c ID\n\n    -- \uc0c1\ud0dc\n    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'completed', 'failed', 'refunded'\n\n    -- \uc2e4\ud328 \uc815\ubcf4\n    failure_reason TEXT,\n\n    -- \ud0c0\uc784\uc2a4\ud0ec\ud504\n    paid_at TIMESTAMPTZ,\n    refunded_at TIMESTAMPTZ,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_payments_order ON payments(order_id);\nCREATE INDEX idx_payments_status ON payments(status);\nCREATE INDEX idx_payments_transaction ON payments(transaction_id);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"5-\ub9ac\ubdf0-\ubc0f-\ud3c9\uc810",children:"5. \ub9ac\ubdf0 \ubc0f \ud3c9\uc810"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE reviews (\n    id BIGSERIAL PRIMARY KEY,\n    product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,\n    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    order_item_id BIGINT REFERENCES order_items(id),  -- \uad6c\ub9e4 \ud655\uc778\n\n    -- \ud3c9\uc810\n    rating INTEGER NOT NULL CHECK (rating BETWEEN 1 AND 5),\n\n    -- \ub9ac\ubdf0 \ub0b4\uc6a9\n    title VARCHAR(200),\n    content TEXT NOT NULL,\n\n    -- \uc774\ubbf8\uc9c0\n    images JSONB,  -- [\"url1\", \"url2\", ...]\n\n    -- \uac80\uc99d\n    is_verified_purchase BOOLEAN DEFAULT false,\n\n    -- \ud1b5\uacc4\n    helpful_count INTEGER DEFAULT 0,\n    unhelpful_count INTEGER DEFAULT 0,\n\n    -- \ud310\ub9e4\uc790 \uc751\ub2f5\n    seller_response TEXT,\n    seller_response_at TIMESTAMPTZ,\n\n    -- \uc0c1\ud0dc\n    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'approved', 'rejected'\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\n-- \uc0ac\uc6a9\uc790\ub294 \uc0c1\ud488\ub2f9 \ud558\ub098\uc758 \ub9ac\ubdf0\ub9cc\nCREATE UNIQUE INDEX uq_reviews_user_product\nON reviews(user_id, product_id);\n\nCREATE INDEX idx_reviews_product ON reviews(product_id);\nCREATE INDEX idx_reviews_user ON reviews(user_id);\nCREATE INDEX idx_reviews_rating ON reviews(rating);\n\n-- \ub9ac\ubdf0 \ub3c4\uc6c0 \ud22c\ud45c\nCREATE TABLE review_votes (\n    review_id BIGINT NOT NULL REFERENCES reviews(id) ON DELETE CASCADE,\n    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    is_helpful BOOLEAN NOT NULL,  -- true = \ub3c4\uc6c0\ub428, false = \ub3c4\uc6c0 \uc548\ub428\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n\n    PRIMARY KEY (review_id, user_id)\n);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"6-\ucfe0\ud3f0-\ubc0f-\ud504\ub85c\ubaa8\uc158",children:"6. \ucfe0\ud3f0 \ubc0f \ud504\ub85c\ubaa8\uc158"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE coupons (\n    id BIGSERIAL PRIMARY KEY,\n\n    -- \ucf54\ub4dc\n    code VARCHAR(50) UNIQUE NOT NULL,\n    description TEXT,\n\n    -- \ud560\uc778 \ud0c0\uc785\n    discount_type VARCHAR(20) NOT NULL,  -- 'percentage', 'fixed_amount'\n    discount_value NUMERIC(10, 2) NOT NULL,\n\n    -- \uc870\uac74\n    min_purchase_amount NUMERIC(10, 2),  -- \ucd5c\uc18c \uad6c\ub9e4 \uae08\uc561\n    max_discount_amount NUMERIC(10, 2),  -- \ucd5c\ub300 \ud560\uc778 \uae08\uc561\n    usage_limit INTEGER,  -- \uc804\uccb4 \uc0ac\uc6a9 \ud69f\uc218 \uc81c\ud55c\n    usage_limit_per_user INTEGER DEFAULT 1,  -- \uc0ac\uc6a9\uc790\ub2f9 \uc0ac\uc6a9 \ud69f\uc218\n\n    -- \uc720\ud6a8 \uae30\uac04\n    valid_from TIMESTAMPTZ NOT NULL,\n    valid_until TIMESTAMPTZ NOT NULL,\n\n    -- \uc0c1\ud0dc\n    is_active BOOLEAN DEFAULT true,\n\n    -- \ud1b5\uacc4\n    usage_count INTEGER DEFAULT 0,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_coupons_code ON coupons(code);\nCREATE INDEX idx_coupons_valid ON coupons(valid_from, valid_until);\n\n-- \ucfe0\ud3f0 \uc0ac\uc6a9 \uc774\ub825\nCREATE TABLE coupon_usages (\n    id BIGSERIAL PRIMARY KEY,\n    coupon_id BIGINT NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,\n    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,\n\n    discount_amount NUMERIC(10, 2) NOT NULL,\n\n    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_coupon_usages_coupon ON coupon_usages(coupon_id);\nCREATE INDEX idx_coupon_usages_user ON coupon_usages(user_id);\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\ud2b8\ub9ac\uac70-\ubc0f-\ud568\uc218",children:"\ud83d\udd27 \ud2b8\ub9ac\uac70 \ubc0f \ud568\uc218"}),"\n",(0,r.jsx)(e.h3,{id:"\uc8fc\ubb38-\uc0dd\uc131-\ud568\uc218",children:"\uc8fc\ubb38 \uc0dd\uc131 \ud568\uc218"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION create_order_from_cart(\n    p_user_id BIGINT,\n    p_shipping_address_id BIGINT,\n    p_coupon_code VARCHAR(50) DEFAULT NULL\n) RETURNS BIGINT AS $$\nDECLARE\n    v_order_id BIGINT;\n    v_order_number VARCHAR(50);\n    v_subtotal NUMERIC(10, 2) := 0;\n    v_shipping_fee NUMERIC(10, 2) := 3000;  -- \uace0\uc815 \ubc30\uc1a1\ube44\n    v_tax NUMERIC(10, 2) := 0;\n    v_discount NUMERIC(10, 2) := 0;\n    v_total NUMERIC(10, 2);\n    v_address RECORD;\nBEGIN\n    -- \uc8fc\ubb38 \ubc88\ud638 \uc0dd\uc131\n    v_order_number := 'ORD-' || TO_CHAR(CURRENT_TIMESTAMP, 'YYYYMMDD-') ||\n                      LPAD(nextval('order_number_seq')::TEXT, 6, '0');\n\n    -- \ubc30\uc1a1 \uc8fc\uc18c \uc870\ud68c\n    SELECT * INTO v_address FROM user_addresses\n    WHERE id = p_shipping_address_id AND user_id = p_user_id;\n\n    -- \uc7a5\ubc14\uad6c\ub2c8 \ud569\uacc4 \uacc4\uc0b0\n    SELECT SUM(quantity * price_snapshot) INTO v_subtotal\n    FROM cart_items\n    WHERE user_id = p_user_id;\n\n    -- \ucfe0\ud3f0 \ud560\uc778 \uc801\uc6a9\n    IF p_coupon_code IS NOT NULL THEN\n        -- \ucfe0\ud3f0 \uac80\uc99d \ubc0f \ud560\uc778 \uacc4\uc0b0 (\uc0dd\ub7b5)\n        v_discount := 0;  -- \uc2e4\uc81c \uacc4\uc0b0 \ub85c\uc9c1\n    END IF;\n\n    -- \ucd1d\uc561 \uacc4\uc0b0\n    v_total := v_subtotal + v_shipping_fee + v_tax - v_discount;\n\n    -- \uc8fc\ubb38 \uc0dd\uc131\n    INSERT INTO orders (\n        user_id, order_number,\n        subtotal, shipping_fee, tax, discount, total,\n        shipping_name, shipping_phone, shipping_address,\n        shipping_postal_code, shipping_city, shipping_state,\n        coupon_code\n    )\n    VALUES (\n        p_user_id, v_order_number,\n        v_subtotal, v_shipping_fee, v_tax, v_discount, v_total,\n        v_address.recipient_name, v_address.phone, v_address.address1 || ' ' || COALESCE(v_address.address2, ''),\n        v_address.postal_code, v_address.city, v_address.state,\n        p_coupon_code\n    )\n    RETURNING id INTO v_order_id;\n\n    -- \uc8fc\ubb38 \ud56d\ubaa9 \uc0dd\uc131 (\uc7a5\ubc14\uad6c\ub2c8\uc5d0\uc11c)\n    INSERT INTO order_items (\n        order_id, product_id, variant_id,\n        product_name, sku, quantity, unit_price, subtotal\n    )\n    SELECT\n        v_order_id,\n        ci.product_id,\n        ci.variant_id,\n        p.name,\n        COALESCE(pv.sku, p.sku),\n        ci.quantity,\n        ci.price_snapshot,\n        ci.quantity * ci.price_snapshot\n    FROM cart_items ci\n    JOIN products p ON ci.product_id = p.id\n    LEFT JOIN product_variants pv ON ci.variant_id = pv.id\n    WHERE ci.user_id = p_user_id;\n\n    -- \uc7a5\ubc14\uad6c\ub2c8 \ube44\uc6b0\uae30\n    DELETE FROM cart_items WHERE user_id = p_user_id;\n\n    RETURN v_order_id;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\uc0c1\ud488-\ud3c9\uc810-\uc790\ub3d9-\uac31\uc2e0",children:"\uc0c1\ud488 \ud3c9\uc810 \uc790\ub3d9 \uac31\uc2e0"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION update_product_rating()\nRETURNS TRIGGER AS $$\nBEGIN\n    UPDATE products\n    SET\n        rating_average = (\n            SELECT AVG(rating)::NUMERIC(3,2)\n            FROM reviews\n            WHERE product_id = NEW.product_id\n              AND status = 'approved'\n        ),\n        review_count = (\n            SELECT COUNT(*)\n            FROM reviews\n            WHERE product_id = NEW.product_id\n              AND status = 'approved'\n        )\n    WHERE id = NEW.product_id;\n\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER update_rating_after_review\nAFTER INSERT OR UPDATE ON reviews\nFOR EACH ROW\nEXECUTE FUNCTION update_product_rating();\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\uc8fc\uc694-\ucffc\ub9ac",children:"\ud83d\udcca \uc8fc\uc694 \ucffc\ub9ac"}),"\n",(0,r.jsx)(e.h3,{id:"\uc0c1\ud488-\ubaa9\ub85d-\uc870\ud68c",children:"\uc0c1\ud488 \ubaa9\ub85d \uc870\ud68c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \uce74\ud14c\uace0\ub9ac\ubcc4 \uc0c1\ud488 \ubaa9\ub85d (\ud544\ud130\ub9c1, \uc815\ub82c, \ud398\uc774\uc9c0\ub124\uc774\uc158)\nSELECT\n    p.id,\n    p.name,\n    p.slug,\n    p.price,\n    p.compare_at_price,\n    p.rating_average,\n    p.review_count,\n    pi.url as image_url,\n    p.stock_quantity > 0 as in_stock\nFROM products p\nLEFT JOIN product_images pi ON p.id = pi.product_id AND pi.is_primary = true\nWHERE p.category_id = 1\n  AND p.status = 'active'\n  AND p.is_available = true\n  AND p.price BETWEEN 10000 AND 100000  -- \uac00\uaca9 \ud544\ud130\n  AND p.stock_quantity > 0  -- \uc7ac\uace0 \uc788\uc74c\nORDER BY p.order_count DESC  -- \uc778\uae30\uc21c\nLIMIT 20 OFFSET 0;\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\uc8fc\ubb38-\uc0c1\uc138-\uc870\ud68c",children:"\uc8fc\ubb38 \uc0c1\uc138 \uc870\ud68c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"SELECT\n    o.order_number,\n    o.status,\n    o.total,\n    o.created_at,\n    json_agg(\n        json_build_object(\n            'product_name', oi.product_name,\n            'quantity', oi.quantity,\n            'unit_price', oi.unit_price,\n            'subtotal', oi.subtotal\n        )\n    ) as items\nFROM orders o\nJOIN order_items oi ON o.id = oi.order_id\nWHERE o.id = 1\nGROUP BY o.id, o.order_number, o.status, o.total, o.created_at;\n"})}),"\n",(0,r.jsx)(e.h2,{id:"-\ucd5c\uc801\ud654-\ud3ec\uc778\ud2b8",children:"\u2705 \ucd5c\uc801\ud654 \ud3ec\uc778\ud2b8"}),"\n",(0,r.jsx)(e.h3,{id:"\uc778\ub371\uc2a4-\uc804\ub7b5",children:"\uc778\ub371\uc2a4 \uc804\ub7b5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \ubcf5\ud569 \uc778\ub371\uc2a4 (\uce74\ud14c\uace0\ub9ac + \uc0c1\ud0dc + \uac00\uaca9)\nCREATE INDEX idx_products_category_status_price\nON products(category_id, status, price)\nWHERE is_available = true AND stock_quantity > 0;\n\n-- \uc8fc\ubb38 \uc870\ud68c \ucd5c\uc801\ud654\nCREATE INDEX idx_orders_user_created\nON orders(user_id, created_at DESC);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\ud30c\ud2f0\uc154\ub2dd",children:"\ud30c\ud2f0\uc154\ub2dd"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"-- \uc8fc\ubb38 \ud14c\uc774\ube14 \uc6d4\ubcc4 \ud30c\ud2f0\uc154\ub2dd\nCREATE TABLE orders_partitioned (\n    LIKE orders INCLUDING ALL\n) PARTITION BY RANGE (created_at);\n\nCREATE TABLE orders_2024_01 PARTITION OF orders_partitioned\nFOR VALUES FROM ('2024-01-01') TO ('2024-02-01');\n"})}),"\n",(0,r.jsx)(e.p,{children:"\uc774 \uc124\uacc4\ub294 \uc2e4\uc81c \uc804\uc790\uc0c1\uac70\ub798 \uc2dc\uc2a4\ud15c\uc758 \uae30\ubcf8 \uad6c\uc870\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \uaddc\ubaa8\uc640 \uc694\uad6c\uc0ac\ud56d\uc5d0 \ub530\ub77c \ucd94\uac00 \uae30\ub2a5(\uc704\uc2dc\ub9ac\uc2a4\ud2b8, \ud3ec\uc778\ud2b8, \uba64\ubc84\uc2ed \ub4f1)\uc744 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(e.h2,{id:"-\ub2e4\uc74c-\ub2e8\uacc4",children:"\ud83d\ude80 \ub2e4\uc74c \ub2e8\uacc4"}),"\n",(0,r.jsx)(e.p,{children:"\uc804\uc790\uc0c1\uac70\ub798 \uc124\uacc4\ub97c \ub9c8\uc2a4\ud130\ud588\ub2e4\uba74, \uc774\uc81c \uc18c\uc15c \ubbf8\ub514\uc5b4 \uc2dc\uc2a4\ud15c\uc744 \ubc30\uc6cc\ubd05\uc2dc\ub2e4!"}),"\n",(0,r.jsxs)(e.p,{children:["\ud83d\udc49 ",(0,r.jsx)(e.a,{href:"./social-media",children:"\uc18c\uc15c \ubbf8\ub514\uc5b4"})]})]})}function o(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(_,{...n})}):_(n)}}}]);